<hra-expansion-panel tagline="Sample Metadata">
  <hra-expansion-panel-actions>
    <button
      mat-icon-button
      [matMenuTriggerFor]="menu"
      [hraIconButtonSize]="'large'"
      aria-label="Icon to open nested menu"
      hraPlainTooltip="More"
    >
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #menu="matMenu" class="metadata-overlay">
      <button mat-menu-item [matMenuTriggerFor]="infoSubMenu" class="expanded" matRipple matRippleColor="#201E3D14">
        <mat-icon>info</mat-icon>
        <span>Info</span>
        <mat-icon class="expand-arrow">arrow_right</mat-icon>
      </button>
      @if (hasEmptyFields()) {
        <button mat-menu-item (click)="toggleEmptyFields()">
          <mat-icon>{{ showEmptyFields() ? 'visibility_off' : 'visibility' }}visibility</mat-icon>
          {{ showEmptyFields() ? 'Hide' : 'Show' }} Unknown Metadata
        </button>
      }
      <a
        mat-menu-item
        href="https://github.com/hubmapconsortium/hra-ui/blob/main/apps/cde-visualization-wc/EMBEDDING.md"
        target="_blank"
        rel="noopener noreferrer"
      >
        <mat-icon>code</mat-icon>
        Embed App
      </a>
      <mat-menu #infoSubMenu="matMenu" class="info-sub-menu"> Visualization metadata for the sample dataset. </mat-menu>
    </mat-menu>
  </hra-expansion-panel-actions>
  <div class="metadata-details">
    <div class="metadata-row">
      @if (isFieldVisible('title')) {
        <span class="metadata-row-label"> Source publication </span>
        <span class="metadata-row-value">
          @if (metadata().sampleExtra; as extra) {
            <a hraHyperlink [attr.href]="extra.sampleUrl" target="_blank" rel="noreferrer noopener">
              {{ extra.sampleUrl }}
            </a>
          } @else {
            <span class="metadata-row-value">{{ metadata().title | defaultTo: 'Unknown' }}</span>
          }
        </span>
      }
    </div>
    <div class="metadata-row">
      <span class="metadata-row-label">Source data</span>
      <span>
        @if (metadata().sampleExtra; as extra) {
          <a hraHyperlink [attr.href]="extra.sourceDataUrl" target="_blank" rel="noreferrer noopener">
            {{ metadata().sourceFileName }}
          </a>
        } @else {
          <span>{{ metadata().sourceFileName | defaultTo: 'Unknown' }}</span>
        }
      </span>
    </div>
    @if (isFieldVisible('colorMapFileName')) {
      <div class="metadata-row">
        <span class="metadata-row-label">Color map</span>
        <span class="metadata-row-value">{{ metadata().colorMapFileName | defaultTo: 'Default' }}</span>
      </div>
    }
    @if (isFieldVisible('organ')) {
      <div class="metadata-row">
        <span class="metadata-row-label">Organ</span>
        <span class="metadata-row-value">{{ metadata().organ | defaultTo: 'Unknown' }}</span>
      </div>
    }
    @if (isFieldVisible('technology')) {
      <div class="metadata-row">
        <span class="metadata-row-label">Technology</span>
        <span class="metadata-row-value">{{ metadata().technology | defaultTo: 'Unknown' }}</span>
      </div>
    }
    @if (isFieldVisible('sex')) {
      <div class="metadata-row">
        <span class="metadata-row-label">Sex</span>
        <span class="metadata-row-value">{{ metadata().sex | defaultTo: 'Unknown' }}</span>
      </div>
    }
    @if (isFieldVisible('age')) {
      <div class="metadata-row">
        <span class="metadata-row-label">Age</span>
        <span class="metadata-row-value">{{ metadata().age | defaultTo: 'Unknown' }}</span>
      </div>
    }
    @if (isFieldVisible('thickness')) {
      <div class="metadata-row">
        <span class="metadata-row-label">Thickness (µm)</span>
        <span class="metadata-row-value">{{ metadata().thickness | defaultTo: 'Unknown' }}</span>
      </div>
    }
    @if (isFieldVisible('pixelSize')) {
      <div class="metadata-row">
        <span class="metadata-row-label">Pixel size (µm/pixel)</span>
        <span class="metadata-row-value">{{ metadata().pixelSize | defaultTo: 'Unknown' }}</span>
      </div>
    }
    <div class="metadata-row">
      <span class="metadata-row-label">Creation date</span>
      <span class="metadata-row-value">{{ formatCreationTimestamp(dateFormat) | defaultTo: 'Unknown' }}</span>
    </div>
    <div class="metadata-row">
      <span class="metadata-row-label">Creation time</span>
      <span class="metadata-row-value">{{ formatCreationTimestamp(timeFormat) | defaultTo: 'Unknown' }}</span>
    </div>
  </div>
</hra-expansion-panel>
