<mat-accordion displayMode="flat">
  <mat-expansion-panel expanded [style.overflow]="panel.expanded && overflowVisible ? 'visible' : null" #panel>
    <mat-expansion-panel-header class="header">
      <mat-panel-title class="title">
        <mat-icon class="material-symbols-rounded">{{ panel.expanded ? 'remove' : 'add' }}</mat-icon>
        Histogram
        <mat-icon
          class="material-symbols-rounded"
          cdkOverlayOrigin
          #resetTrigger="cdkOverlayOrigin"
          (mouseover)="infoOpen = true"
          (mouseout)="infoOpen = false"
          >info</mat-icon
        >
        <ng-template
          cdkConnectedOverlay
          [cdkConnectedOverlayPanelClass]="['info-tooltip-panel', 'histogram-panel']"
          [cdkConnectedOverlayOrigin]="resetTrigger"
          [cdkConnectedOverlayPositions]="tooltipPosition"
          [cdkConnectedOverlayOpen]="infoOpen"
          [cdkConnectedOverlayOffsetX]="5"
        >
          <div>
            The graph shows a histogram of cell-to-nearest-anchor cell distance distributions categorized by each cell
            type in the dataset.
          </div>
        </ng-template>

        <div class="filler"></div>

        <button mat-flat-button color="accent" class="mat-caption download" (click)="download($event, 'svg')">
          <mat-icon class="material-symbols-rounded">download</mat-icon>
          SVG
        </button>
        <button mat-flat-button color="accent" class="mat-caption download" (click)="download($event, 'png')">
          <mat-icon class="material-symbols-rounded">download</mat-icon>
          PNG
        </button>
      </mat-panel-title>
    </mat-expansion-panel-header>

    <div class="content">
      <div class="histogram" #histogram></div>
      <div class="legend">
        @for (type of cellTypesWithTotal(); track type.name) {
          <cde-color-picker-label
            [label]="type.name"
            [color]="type.color"
            [isAnchor]="type.name === selectedCellType()"
            (colorPickerOpen)="overflowVisible = $event"
            (colorChange)="updateColor(type, $event)"
          ></cde-color-picker-label>
        }
      </div>
    </div>
  </mat-expansion-panel>
</mat-accordion>
