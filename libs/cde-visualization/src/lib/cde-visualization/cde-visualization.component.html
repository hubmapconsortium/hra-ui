<div class="header">
  <cde-visualization-header
    (resetView)="visualization.resetView()"
    (resetAll)="cellTypesTable.resetSort(); visualization.resetView(); histogram.resetAllCellsColor(); resetCellTypes()"
    (downloadNodes)="downloadNodes()"
    (downloadEdges)="downloadEdges()"
    [homeLink]="homeLink()"
  ></cde-visualization-header>
</div>

<div class="metadata">
  <cde-metadata [metadata]="mergedMetadata()"></cde-metadata>
  <cde-cell-types
    [(cellTypes)]="cellTypes"
    [(cellTypesSelection)]="cellTypesSelection"
    [selectedCellType]="selectedNodeTargetValue()"
    (downloadColorMap)="downloadColorMap()"
    (downloadNodes)="downloadNodes()"
    (downloadEdges)="downloadEdges()"
    (resetAllColors)="histogram.resetAllCellsColor(); resetCellTypes()"
    #cellTypesTable
  ></cde-cell-types>
</div>

<div class="visualizations">
  <div class="top">
    <cde-node-dist-visualization
      [nodes]="loadedNodes()"
      [nodeTargetKey]="nodeTypeKey()"
      [nodeTargetValue]="selectedNodeTargetValue()"
      [edges]="loadedEdges()"
      [maxEdgeDistance]="maxEdgeDistance()"
      [colorMap]="cellTypesAsColorMap()"
      [colorMapKey]="colorMapTypeKey()"
      [colorMapValueKey]="colorMapValueKey()"
      [cellTypesSelection]="cellTypesSelection()"
      (nodeClick)="nodeClick.emit($event)"
      (nodeHover)="nodeHover.emit($event)"
      (edgesChange)="edges.set($event)"
      (resetAllCells)="resetCellTypes()"
      #visualization
    ></cde-node-dist-visualization>

    <cde-violin [colors]="filteredColors()" [data]="filteredDistances()" #violin></cde-violin>
  </div>

  <cde-histogram
    [colors]="filteredColors()"
    [data]="filteredDistances()"
    [filteredCellTypes]="filteredCellTypes()"
    [selectedCellType]="selectedNodeTargetValue()"
    (updateColor)="updateColor($event.entry, $event.color)"
    #histogram
  ></cde-histogram>
</div>
