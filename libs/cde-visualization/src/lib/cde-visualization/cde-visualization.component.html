<ng-container hraFeature="cde-visualization">
  @if (loadingManager.isLoading$ | async) {
    <mat-progress-bar class="progress" mode="indeterminate" hraFeature="loading-progress"></mat-progress-bar>
  }

  <div class="metadata">
    <cde-metadata [metadata]="metadataView()" hraFeature="metadata"></cde-metadata>
    <cde-cell-types
      [(cellTypes)]="cellTypes"
      [(cellTypesSelection)]="cellTypesSelection"
      [selectedCellType]="nodeTargetSelector()"
      [countAdjustments]="countAdjustments()"
      (downloadNodes)="downloadNodes()"
      (downloadEdges)="downloadEdges()"
      (downloadColorMap)="downloadColorMap()"
      (resetAllColors)="histogram.resetAllCellsColor(); resetCellTypes()"
      hraFeature="cell-types"
      #cellTypesTable
    ></cde-cell-types>
  </div>

  <div class="visualizations">
    <div class="top">
      <cde-node-dist-visualization
        [nodes]="nodesView()"
        [edges]="edgesView()"
        [maxEdgeDistance]="maxEdgeDistance()"
        [colorMap]="cellTypesAsColorMap()"
        [(nodeFilter)]="nodeFilterView"
        (nodeClick)="nodeClick.emit($event)"
        (nodeHover)="nodeHover.emit($event)"
        (resetAllCells)="resetCellTypes()"
        hraFeature="visualization"
      ></cde-node-dist-visualization>

      <cde-violin [colors]="filteredColors()" [data]="filteredDistances()" hraFeature="violin-graph"></cde-violin>
    </div>

    <cde-histogram
      [colors]="filteredColors()"
      [data]="filteredDistances()"
      [filteredCellTypes]="filteredCellTypes()"
      (updateColor)="updateColor($event.entry, $event.color)"
      hraFeature="histogram"
      #histogram
    ></cde-histogram>
  </div>
</ng-container>
