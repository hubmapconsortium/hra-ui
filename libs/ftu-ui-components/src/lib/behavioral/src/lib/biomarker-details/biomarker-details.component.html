@if (!isBiomarkerfullscreen()) {
  <div class="biomarker-header">
    <span class="biomarker-header-title">Cell types by biomarkers</span>
    @if (tab.rows.length !== 0) {
      <button
        mat-icon-button
        hraIconButtonSize="large"
        hraPlainTooltip="Open in full screen"
        (click)="isBiomarkerfullscreen.set(true)"
      >
        <mat-icon>fullscreen</mat-icon>
      </button>
    }
  </div>
}

<mat-button-toggle-group
  hraButtonToggleSize="medium"
  [value]="tab.rows.length !== 0 ? selectedToggleValue : null"
  (change)="onToggleChange($event.value)"
  class="biomarker-toggle-group absolute-toggle"
>
  @for (option of toggleOptions; track option.value) {
    <mat-button-toggle [value]="option.value" [disabled]="isToggleOptionDisabled($index)">{{
      option.label
    }}</mat-button-toggle>
  }
</mat-button-toggle-group>

@if (tab.rows.length !== 0) {
  <ftu-biomarker-table
    #table
    [class.small]="tab.rows.length < 10"
    [data]="$any(tab.rows)"
    [columns]="tab.columns"
    [gradient]="gradients()"
    [sizes]="sizes()"
    [tissueInfo]="tissueInfo"
    [illustrationIds]="illustrationIds"
    [dataSources]="source()"
    [highlightedCellId]="selectedOnHovered()?.ontologyId ?? ''"
    (rowHover)="highlightCells($event)"
  ></ftu-biomarker-table>
}

@if (source().length === 0 || (source().length > 0 && selectedSources().length > 0 && tab.rows.length === 0)) {
  <mat-divider class="empty-state-divider"></mat-divider>
  <ftu-empty-biomarker
    emptyBehaviorText="We currently do not have cell type data for the selected biomarker."
  ></ftu-empty-biomarker>
}

@if (source().length > 0 && selectedSources().length === 0) {
  <div class="select-data-message">
    <hra-info-message-indicator> Select source data to view cell types by biomarkers. </hra-info-message-indicator>
  </div>
}

@if (tab.rows.length > 0) {
  <div class="legend">
    <button
      class="legend-percentage"
      [hraRichTooltip]
      hraRichTooltipTagline="Percentage of cells"
      [hraRichTooltipDescription]="percentageTooltipText"
    >
      <span class="legend-header-percentage">Percentage of cells</span>
      <ftu-size-legend [sizes]="sizes()" class="content"></ftu-size-legend>
    </button>
    <button
      class="legend-gradient"
      [hraRichTooltip]
      hraRichTooltipTagline="Biomarker expression mean"
      [hraRichTooltipDescription]="expressionTooltipText"
    >
      <span class="legend-header-gradient">Biomarker expression mean</span>
      <ftu-gradient-legend [gradient]="gradients()" class="content"></ftu-gradient-legend>
    </button>
  </div>
}

@if (!(source().length > 0 && selectedSources().length > 0 && tab.rows.length === 0)) {
  <div class="source-list" [style.display]="isBiomarkerfullscreen() ? 'none' : undefined">
    <ftu-source-list
      [collaborateText]="collaborateText"
      (collaborateClick)="collaborate()"
      [sources]="source()"
      (selectionChanged)="setSelectedSources($event); selectedSources.set($event)"
      class="content"
      [(isFullscreen)]="isSourceListfullscreen"
      (isFullscreenChange)="isSourceListfullscreen.set(true)"
    ></ftu-source-list>
  </div>
}

<ng-template #infoTooltip let-tooltip>
  <div class="biomarker-details info-tooltip">
    {{ tooltip }}
  </div>
</ng-template>

<ng-template #sourceList>
  <ftu-source-list
    [collaborateText]="collaborateText"
    (collaborateClick)="collaborate()"
    [sources]="source()"
    (selectionChanged)="setSelectedSources($event)"
    class="content"
    (isFullscreen)="isSourceListfullscreen.set(true)"
    [hideTitle]="true"
  ></ftu-source-list>
</ng-template>
