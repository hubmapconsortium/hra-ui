<mat-tab-group
  hraFeature="tabs"
  hraClickEvent
  hraClickEventTriggerOn="none"
  #tabEvent="hraClickEvent"
  [class.table-fullscreen]="isTableFullScreen"
  (selectedTabChange)="tabEvent.logEvent(undefined, undefined, { tab: $event.tab.textLabel })"
  disablePagination="true"
  disableRipple="true"
>
  <mat-tab hraFeature="illustration-tab" label="FTU Illustration">
    <ftu-interactive-svg
      hraHoverEvent
      hraFeature="illustration"
      [url]="currentUrl()"
      [mapping]="mapping()"
      (nodeHover)="updateNodeOnHover($event)"
      (nodeClick)="updateNodeOnClicked($event)"
    >
    </ftu-interactive-svg>
  </mat-tab>

  <mat-tab hraFeature="source-data-tab" label="Source Data">
    <div class="source-list">
      @if (source().length > 0) {
        <ftu-source-list
          [message]="message"
          [sources]="source()"
          [hideTitle]="true"
          (selectionChanged)="setSelectedSources($event); selectedSources.set($event)"
          class="content"
        ></ftu-source-list>
      }

      @if (source().length === 0 || (source().length > 0 && selectedSources().length > 0 && tab.rows.length === 0)) {
        <ftu-empty-biomarker
          class="wc-empty-biomarker"
          emptyBehaviorText="We currently do not have cell type by biomarker data for genes, proteins, or lipids."
        ></ftu-empty-biomarker>
      }
    </div>
  </mat-tab>

  <mat-tab hraFeature="biomarkers-tab" label="Cell types by Biomarkers" [disabled]="tab.rows.length === 0">
    <div class="biomarker-details">
      <div class="legend" hraFeature="legends">
        <button
          hraClickEvent
          hraFeature="percentage"
          class="legend-percentage"
          [hraRichTooltip]
          hraRichTooltipTagline="Percentage of cells"
          [hraRichTooltipDescription]="percentageTooltipText"
        >
          <span class="legend-header-percentage">Percentage of cells</span>
          <ftu-size-legend [sizes]="sizes()" class="content"></ftu-size-legend>
        </button>
        <mat-divider [vertical]="true"></mat-divider>
        <button
          hraClickEvent
          hraFeature="expression"
          class="legend-gradient"
          [hraRichTooltip]
          hraRichTooltipTagline="Biomarker expression mean"
          [hraRichTooltipDescription]="expressionTooltipText"
        >
          <span class="legend-header-gradient">Biomarker expression mean</span>
          <ftu-gradient-legend [gradient]="gradients()" class="content"></ftu-gradient-legend>
        </button>
      </div>
      <mat-button-toggle-group
        hraButtonToggleSize="medium"
        [value]="tab.rows.length !== 0 ? selectedToggleValue : null"
        (change)="onToggleChange($event.value)"
        class="biomarker-toggle-group absolute-toggle"
      >
        @for (option of toggleOptions; track option.value) {
          <mat-button-toggle [value]="option.value" [disabled]="isToggleOptionDisabled($index)">{{
            option.label
          }}</mat-button-toggle>
        }
      </mat-button-toggle-group>

      @if (tab.rows.length !== 0) {
        <ftu-biomarker-table
          #table
          [class.small]="tab.rows.length < 10"
          [data]="$any(tab.rows)"
          [columns]="tab.columns"
          [gradient]="gradients()"
          [sizes]="sizes()"
          [tissueInfo]="tissueInfo"
          [illustrationIds]="illustrationIds"
          [dataSources]="source()"
          [highlightedCellId]="selectedOnHovered()?.ontologyId ?? ''"
          (rowHover)="highlightCells($event)"
        ></ftu-biomarker-table>
      }
    </div>
  </mat-tab>
</mat-tab-group>
