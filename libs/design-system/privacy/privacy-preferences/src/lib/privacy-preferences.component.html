<div class="header">
  <hra-brand-logo size="small"></hra-brand-logo>
  @if (hasProvidedPreferences()) {
    <button mat-icon-button (click)="this.close.set(true)" aria-label="Close">
      <mat-icon>close</mat-icon>
    </button>
  }
</div>

<mat-divider></mat-divider>

<mat-tab-group mat-stretch-tabs [(selectedIndex)]="tabIndex" class="tab-group">
  <mat-tab label="Consent">
    <div class="consent-content">
      <p>This website uses cookies and similar technologies.</p>
      <p>
        We use anonymized statistics data insights to improve our website. Marketing cookies are needed to watch videos
        on this website.
      </p>
    </div>
  </mat-tab>
  <mat-tab label="Details">
    <ng-scrollbar hraScrollOverflowFade>
      @for (category of categories(); track category.id; let isLast = $last) {
        <div class="category-container">
          <div class="preference-row">
            <button
              mat-icon-button
              hraIconButtonSize="large"
              class="expand-button"
              (click)="expandCategory(category.id)"
              [attr.aria-label]="category.expanded ? 'Collapse ' + category.title : 'Expand ' + category.title"
            >
              <mat-icon>{{ category.expanded ? 'remove' : 'add' }}</mat-icon>
            </button>

            <p>{{ category.title }}</p>

            <div class="filler"></div>

            <mat-slide-toggle
              role="switch"
              [checked]="category.enabled"
              [disabled]="category.isRequired"
              (change)="toggleEnabled(category.id, $event.checked)"
              [attr.aria-label]="category.title"
            >
            </mat-slide-toggle>
          </div>

          <p class="description">
            {{ category.description }}
          </p>

          @if (category.expanded) {
            <div class="privacy-details">
              @if (category.privacyDetails) {
                <p class="privacy-text">{{ category.privacyDetails }}</p>
              }
              @if (category.providerName && category.providerLink) {
                <p class="provider-title">{{ category.providerName }}</p>
                <div class="provider-link">
                  <hra-text-hyperlink text="Learn more about this provider" [url]="category.providerLink">
                  </hra-text-hyperlink>
                  <mat-icon>open_in_new</mat-icon>
                </div>
              }
            </div>
          }
          @if (!isLast) {
            <mat-divider></mat-divider>
          }
        </div>
      }
    </ng-scrollbar>
  </mat-tab>
</mat-tab-group>

<mat-divider></mat-divider>

<div class="footer-buttons">
  <button
    mat-flat-button
    hraCtaButton
    hraPrimaryButton
    (click)="onAllowNecessaryOnly()"
    aria-label="allow necessary only"
  >
    Allow necessary only
  </button>

  @if (tabIndex() === 0) {
    <button mat-button hraCtaButton hraSecondaryButton (click)="tabIndex.set(1)" aria-label="customize">
      Customize
    </button>
  } @else {
    <button mat-flat-button hraCtaButton hraPrimaryButton (click)="onAllowSelection()" aria-label="allow selection">
      Allow selection
    </button>
  }

  <button mat-flat-button hraCtaButton hraPrimaryButton (click)="onAllowAll()" aria-label="Allow all cookies">
    Allow all
  </button>
</div>
