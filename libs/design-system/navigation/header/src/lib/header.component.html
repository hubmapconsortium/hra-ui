@let ctaConfig = cta();
@if (ctaConfig && !ctaDismissed()) {
  <hra-cta-bar
    hraFeature="cta-bar"
    [action]="ctaConfig.action"
    [description]="ctaConfig.description"
    [url]="ctaConfig.url"
    (closeClick)="ctaDismissed.set(true)"
  />
}

<header
  class="header"
  cdkOverlayOrigin
  hraFeature="header"
  [class.mobile-menu-open]="isMobile() && isMenuActive('main')"
  #mobileMenuOrigin="cdkOverlayOrigin"
  data-testid="header"
>
  <div class="menus" hraFeature="navigation" #desktopMenuOrigin>
    <hra-brand-logo size="small" hraFeature="brand-logo" />

    <div class="filler"></div>

    @if (!isMobile()) {
      @for (menu of menus(); track menu.id) {
        <hra-navigation-category-toggle
          cdkOverlayOrigin
          [hraFeature]="'menu-' + menu.id"
          [toggled]="isMenuActive(menu)"
          (toggledChange)="toggleMenu(menu)"
          #navigationCategoryMenuOrigin="cdkOverlayOrigin"
        >
          {{ menu.label }}
        </hra-navigation-category-toggle>

        <ng-template
          cdkConnectedOverlay
          cdkConnectedOverlayHasBackdrop="false"
          cdkConnectedOverlayLockPosition="true"
          cdkConnectedOverlayPush="true"
          [cdkConnectedOverlayOpen]="isMenuActive(menu)"
          [cdkConnectedOverlayOrigin]="navigationCategoryMenuOrigin"
          [cdkConnectedOverlayPositions]="desktopMenuPositions"
          (overlayOutsideClick)="closeMenu()"
        >
          <hra-desktop-menu
            [hraFeature]="'desktop-menu-' + menu.id"
            [menu]="menu"
            [baseUrl]="baseUrl()"
            [style.max-height]="desktopMenuMaxHeight()"
          />
        </ng-template>
      }
    }

    <button
      mat-icon-button
      cdkOverlayOrigin
      hraFeature="menu-toggle"
      aria-label="Open the main navigation menu"
      (click)="toggleMenu('main')"
      [hraClickEvent]="{ action: 'toggle-menu', isMobile: isMobile(), currentState: isMenuActive('main') }"
      #mainMenuOrigin="cdkOverlayOrigin"
    >
      <mat-icon>
        @if (isMenuActive('main')) {
          close
        } @else if (isMobile()) {
          menu
        } @else {
          apps
        }
      </mat-icon>
    </button>

    @if (isMobile()) {
      <ng-template
        cdkConnectedOverlay
        cdkConnectedOverlayDisposeOnNavigation="true"
        cdkConnectedOverlayHasBackdrop="false"
        cdkConnectedOverlayLockPosition="true"
        [cdkConnectedOverlayOpen]="isMenuActive('main')"
        [cdkConnectedOverlayOrigin]="mobileMenuOrigin"
        [cdkConnectedOverlayPositions]="mobileMenuPositions"
        [cdkConnectedOverlayScrollStrategy]="mobileMenuBlockScroll"
        [cdkConnectedOverlayHeight]="mobileMenuHeight()"
        [cdkConnectedOverlayWidth]="'100%'"
        #mobileMenuOverlay
      >
        <hra-mobile-menu hraFeature="mobile-menu" [hubmapMenu]="hubmapMenu()" [menus]="menus()" [baseUrl]="baseUrl()" />
      </ng-template>
    } @else {
      <ng-template
        cdkConnectedOverlay
        cdkConnectedOverlayHasBackdrop="false"
        cdkConnectedOverlayLockPosition="true"
        cdkConnectedOverlayPush="true"
        [cdkConnectedOverlayOpen]="isMenuActive('main')"
        [cdkConnectedOverlayOrigin]="mainMenuOrigin"
        [cdkConnectedOverlayPositions]="desktopMenuPositions"
        (overlayOutsideClick)="closeMenu()"
      >
        <hra-desktop-menu
          hraFeature="desktop-menu-main"
          [menu]="hubmapMenu()"
          [baseUrl]="baseUrl()"
          [style.max-height]="desktopMenuMaxHeight()"
        />
      </ng-template>
    }
  </div>

  @if (breadcrumbs(); as crumbs) {
    <mat-divider />

    <div class="navigation" hraFeature="breadcrumbs">
      <hra-breadcrumbs [crumbs]="crumbs" />
      <ng-content />
    </div>
  }
</header>

@if (progress() !== false) {
  <mat-progress-bar class="progress-bar" hraFeature="progress-bar" [mode]="progressMode()" [value]="progress()" />
}
