<div class="object">
  @if (variant() === 'ftu') {
    <img
      class="viewer-image"
      aria-hidden="true"
      [alt]="viewerCardData().alt"
      [src]="viewerCardData().png"
      (click)="openImageViewer(imageContent)"
      (keyup.enter)="openImageViewer(imageContent)"
    />
    <ng-template #imageContent>
      <div class="dialog-container">
        <div class="dialog-header">
          <ng-container [ngTemplateOutlet]="objectMenu"> </ng-container>
          <div class="filler"></div>
          <button mat-icon-button>
            <mat-icon (click)="close()">clear</mat-icon>
          </button>
        </div>
        <div class="img-container">
          <img class="dialog-image" [src]="viewerCardData().svg" [alt]="viewerCardData().alt" />
        </div>
      </div>
    </ng-template>
  } @else {
    <model-viewer
      class="model-viewer"
      [alt]="viewerCardData().alt"
      [src]="viewerCardData().threeDimImage"
      shadow-intensity="1"
      camera-controls
      auto-rotate
    >
    </model-viewer>
  }
</div>

<ng-container [ngTemplateOutlet]="objectMenu"> </ng-container>

<ng-template #objectMenu>
  <div class="object-menu">
    <span class="tagline">{{ viewerCardData().name }}</span>
    <button
      mat-icon-button
      [matMenuTriggerFor]="menu"
      hraIconButtonSize="large"
      aria-label="Icon to open nested menu"
      hraMicroTooltip="More"
    >
      <mat-icon>more_vert</mat-icon>
    </button>

    <mat-menu #menu="matMenu">
      <button mat-menu-item [matMenuTriggerFor]="submenu">
        <mat-icon>download</mat-icon>
        Downloads
        <mat-icon class="expand-arrow">arrow_right</mat-icon>
      </button>
      <mat-divider class="menu-divider"></mat-divider>
      <a mat-menu-item [href]="viewerCardData().metadata" target="_blank" rel="noopener noreferrer">
        <mat-icon class="reset icon">database</mat-icon>
        View source data
      </a>
    </mat-menu>
    <mat-menu #submenu="matMenu">
      @if (variant() === 'ftu') {
        <button mat-menu-item (click)="downloadClick($event, viewerCardData().svg ?? '')">
          <mat-icon>download</mat-icon>
          SVG
        </button>
        <button mat-menu-item (click)="downloadClick($event, viewerCardData().png ?? '')">
          <mat-icon>download</mat-icon>
          PNG
        </button>
        <a mat-menu-item [href]="viewerCardData().ai">
          <mat-icon>download</mat-icon>
          Adobe Illustrator
        </a>
      } @else {
        <a mat-menu-item [href]="viewerCardData().threeDimImage">
          <mat-icon>download</mat-icon>
          GLB
        </a>
      }
      <mat-divider class="menu-divider"></mat-divider>
      <a mat-menu-item class="csv-button" [href]="viewerCardData().crosswalk">
        <mat-icon>download</mat-icon>
        <span class="csv-label">CSV-Crosswalk</span>
        <span class="csv-desc"> A CSV file connecting digital objects to ontology terms in ASCT+B Tables. </span>
      </a>
    </mat-menu>
  </div>
</ng-template>
