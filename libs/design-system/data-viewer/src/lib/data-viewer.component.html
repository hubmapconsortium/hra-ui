<div class="header">
  <div class="logos">
    <hra-product-logo [id]="iconId()" size="large"></hra-product-logo>
    <div class="organ-icon">
      <mat-icon [svgIcon]="organIcon()"></mat-icon>
    </div>
  </div>
  <span class="header-label">{{ viewerTitle() }}</span>
  <button
    mat-icon-button
    [matMenuTriggerFor]="menu"
    hraIconButtonSize="large"
    aria-label="Icon to open nested menu"
    hraMicroTooltip="More"
  >
    <mat-icon>more_vert</mat-icon>
  </button>

  <mat-menu #menu="matMenu">
    <button mat-menu-item [matMenuTriggerFor]="submenu">
      <mat-icon>download</mat-icon>
      Downloads
      <mat-icon class="expand-arrow">arrow_right</mat-icon>
    </button>
    <a mat-menu-item [href]="allFtuCsvUrl() || allOrgansCsvUrl()">
      <mat-icon class="reset icon">database</mat-icon>
      View source data
    </a>
    <mat-divider class="menu-divider"></mat-divider>
    <a mat-menu-item [href]="githubIconsUrl()" target="_blank" rel="noopener noreferrer">
      <mat-icon [svgIcon]="'social:github'"></mat-icon>
      Get organ icons on GitHub
    </a>
  </mat-menu>
  <mat-menu #submenu="matMenu">
    @if (variant() === '3d-organ') {
      <a mat-menu-item [href]="currentVersion().extractionCsvUrl" target="_blank" rel="noopener noreferrer">
        <mat-icon>download</mat-icon>
        GLB - Extraction sites
      </a>
      <a mat-menu-item [href]="currentVersion().referenceCsvUrl" target="_blank" rel="noopener noreferrer">
        <mat-icon>download</mat-icon>
        GLB - Reference organs
      </a>
      <mat-divider class="menu-divider"></mat-divider>
    }
    <a class="csv-button" mat-menu-item [href]="currentVersion().crosswalk">
      <mat-icon>download</mat-icon>
      <span class="csv-label">CSV-Crosswalk</span>
      <span class="csv-desc"> A CSV file connecting digital objects to ontology terms in ASCT+B Tables. </span>
    </a>
  </mat-menu>
</div>
<div class="content">
  <div class="text-fields">
    <mat-form-field class="select" subscriptSizing="dynamic">
      <mat-icon matPrefix class="search-icon">search</mat-icon>
      <mat-label>Organ</mat-label>
      <mat-select
        disableRipple
        panelClass="options-container"
        (valueChange)="organ.set($event.value)"
        [(value)]="organ"
      >
        @for (organ of organOptions(); track organ) {
          <mat-option [value]="organ">{{ organ.name }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field class="select" subscriptSizing="dynamic">
      <mat-icon matPrefix class="search-icon">search</mat-icon>
      <mat-label>Release Version</mat-label>
      <mat-select
        disableRipple
        panelClass="options-container"
        (valueChange)="currentVersion.set($event.value)"
        [(ngModel)]="currentVersion"
      >
        <mat-select-trigger>{{ currentVersion().releaseName }}</mat-select-trigger>
        @for (dataset of organVersionData(); track dataset) {
          <mat-option [value]="dataset">
            <div class="release-label">
              <span class="release-name">{{ dataset.releaseName }}</span>
              <span class="release-date">{{ dataset.releaseDate }}</span>
            </div>
          </mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <div class="viewer-cards">
    @for (tissue of organ().tissueData; track tissue) {
      <hra-viewer-card [variant]="variant()" [tissue]="tissue"></hra-viewer-card>
    }
  </div>
</div>
