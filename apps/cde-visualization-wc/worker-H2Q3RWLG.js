var Ce=Object.create;var we=Object.defineProperty;var ve=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames;var Me=Object.getPrototypeOf,Re=Object.prototype.hasOwnProperty;var Te=(c,r)=>()=>(r||c((r={exports:{}}).exports,r),r.exports);var Pe=(c,r,s,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of Se(r))!Re.call(c,o)&&o!==s&&we(c,o,{get:()=>r[o],enumerable:!(i=ve(r,o))||i.enumerable});return c};var Oe=(c,r,s)=>(s=c!=null?Ce(Me(c)):{},Pe(r||!c||!c.__esModule?we(s,"default",{value:c,enumerable:!0}):s,c));var _e=Te((de,fe)=>{"use strict";((c,r)=>{typeof fe=="object"&&typeof de<"u"?fe.exports=r():c.Papa=r()})(de,function c(){var r=typeof self<"u"?self:typeof window<"u"?window:r!==void 0?r:{},s,i=!r.document&&!!r.postMessage,o=r.IS_PAPA_WORKER||!1,p={},x=0,a={};function _(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(t){var n=le(t);n.chunkSize=parseInt(n.chunkSize),t.step||t.chunk||(n.chunkSize=null),this._handle=new ye(n),(this._handle.streamer=this)._config=n}).call(this,e),this.parseChunk=function(t,n){var l=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<l){let y=this._config.newline;y||(u=this._config.quoteChar||'"',y=this._handle.guessLineEndings(t,u)),t=[...t.split(y).slice(l)].join(y)}this.isFirstChunk&&C(this._config.beforeFirstChunk)&&(u=this._config.beforeFirstChunk(t))!==void 0&&(t=u),this.isFirstChunk=!1,this._halted=!1;var l=this._partialLine+t,u=(this._partialLine="",this._handle.parse(l,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=u.meta.cursor,l=(this._finished||(this._partialLine=l.substring(t-this._baseIndex),this._baseIndex=t),u&&u.data&&(this._rowCount+=u.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),o)r.postMessage({results:u,workerId:a.WORKER_ID,finished:l});else if(C(this._config.chunk)&&!n){if(this._config.chunk(u,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=u=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(u.data),this._completeResults.errors=this._completeResults.errors.concat(u.errors),this._completeResults.meta=u.meta),this._completed||!l||!C(this._config.complete)||u&&u.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),l||u&&u.meta.paused||this._nextChunk(),u}this._halted=!0},this._sendError=function(t){C(this._config.error)?this._config.error(t):o&&this._config.error&&r.postMessage({workerId:a.WORKER_ID,error:t,finished:!1})}}function N(e){var t;(e=e||{}).chunkSize||(e.chunkSize=a.RemoteChunkSize),_.call(this,e),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(n){this._input=n,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),i||(t.onload=J(this._chunkLoaded,this),t.onerror=J(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var n,l=this._config.downloadRequestHeaders;for(n in l)t.setRequestHeader(n,l[n])}var u;this._config.chunkSize&&(u=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+u));try{t.send(this._config.downloadRequestBody)}catch(y){this._chunkError(y.message)}i&&t.status===0&&this._chunkError()}},this._chunkLoaded=function(){t.readyState===4&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(n=>(n=n.getResponseHeader("Content-Range"))!==null?parseInt(n.substring(n.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(n){n=t.statusText||n,this._sendError(new Error(n))}}function G(e){(e=e||{}).chunkSize||(e.chunkSize=a.LocalChunkSize),_.call(this,e);var t,n,l=typeof FileReader<"u";this.stream=function(u){this._input=u,n=u.slice||u.webkitSlice||u.mozSlice,l?((t=new FileReader).onload=J(this._chunkLoaded,this),t.onerror=J(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var u=this._input,y=(this._config.chunkSize&&(y=Math.min(this._start+this._config.chunkSize,this._input.size),u=n.call(u,this._start,y)),t.readAsText(u,this._config.encoding));l||this._chunkLoaded({target:{result:y}})},this._chunkLoaded=function(u){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(u.target.result)},this._chunkError=function(){this._sendError(t.error)}}function Q(e){var t;_.call(this,e=e||{}),this.stream=function(n){return t=n,this._nextChunk()},this._nextChunk=function(){var n,l;if(!this._finished)return n=this._config.chunkSize,t=n?(l=t.substring(0,n),t.substring(n)):(l=t,""),this._finished=!t,this.parseChunk(l)}}function oe(e){_.call(this,e=e||{});var t=[],n=!0,l=!1;this.pause=function(){_.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){_.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(u){this._input=u,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){l&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=J(function(u){try{t.push(typeof u=="string"?u:u.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(y){this._streamError(y)}},this),this._streamError=J(function(u){this._streamCleanUp(),this._sendError(u)},this),this._streamEnd=J(function(){this._streamCleanUp(),l=!0,this._streamData("")},this),this._streamCleanUp=J(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function ye(e){var t,n,l,u,y=Math.pow(2,53),O=-y,H=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,B=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,E=this,R=0,f=0,z=!1,h=!1,b=[],d={data:[],errors:[],meta:{}};function I(w){return e.skipEmptyLines==="greedy"?w.join("").trim()==="":w.length===1&&w[0].length===0}function P(){if(d&&l&&($("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),l=!1),e.skipEmptyLines&&(d.data=d.data.filter(function(v){return!I(v)})),L()){let v=function(F,S){C(e.transformHeader)&&(F=e.transformHeader(F,S)),b.push(F)};var g=v;if(d)if(Array.isArray(d.data[0])){for(var w=0;L()&&w<d.data.length;w++)d.data[w].forEach(v);d.data.splice(0,1)}else d.data.forEach(v)}function k(v,F){for(var S=e.header?{}:[],D=0;D<v.length;D++){var m=D,j=v[D],j=((A,M)=>(V=>(e.dynamicTypingFunction&&e.dynamicTyping[V]===void 0&&(e.dynamicTyping[V]=e.dynamicTypingFunction(V)),(e.dynamicTyping[V]||e.dynamicTyping)===!0))(A)?M==="true"||M==="TRUE"||M!=="false"&&M!=="FALSE"&&((V=>{if(H.test(V)&&(V=parseFloat(V),O<V&&V<y))return 1})(M)?parseFloat(M):B.test(M)?new Date(M):M===""?null:M):M)(m=e.header?D>=b.length?"__parsed_extra":b[D]:m,j=e.transform?e.transform(j,m):j);m==="__parsed_extra"?(S[m]=S[m]||[],S[m].push(j)):S[m]=j}return e.header&&(D>b.length?$("FieldMismatch","TooManyFields","Too many fields: expected "+b.length+" fields but parsed "+D,f+F):D<b.length&&$("FieldMismatch","TooFewFields","Too few fields: expected "+b.length+" fields but parsed "+D,f+F)),S}var T;d&&(e.header||e.dynamicTyping||e.transform)&&(T=1,!d.data.length||Array.isArray(d.data[0])?(d.data=d.data.map(k),T=d.data.length):d.data=k(d.data,0),e.header&&d.meta&&(d.meta.fields=b),f+=T)}function L(){return e.header&&b.length===0}function $(w,k,T,g){w={type:w,code:k,message:T},g!==void 0&&(w.row=g),d.errors.push(w)}C(e.step)&&(u=e.step,e.step=function(w){d=w,L()?P():(P(),d.data.length!==0&&(R+=w.data.length,e.preview&&R>e.preview?n.abort():(d.data=d.data[0],u(d,E))))}),this.parse=function(w,k,T){var g=e.quoteChar||'"',g=(e.newline||(e.newline=this.guessLineEndings(w,g)),l=!1,e.delimiter?C(e.delimiter)&&(e.delimiter=e.delimiter(w),d.meta.delimiter=e.delimiter):((g=((v,F,S,D,m)=>{var j,A,M,V;m=m||[",","	","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var ee=0;ee<m.length;ee++){for(var q,re=m[ee],U=0,Y=0,K=0,W=(M=void 0,new ue({comments:D,delimiter:re,newline:F,preview:10}).parse(v)),X=0;X<W.data.length;X++)S&&I(W.data[X])?K++:(q=W.data[X].length,Y+=q,M===void 0?M=q:0<q&&(U+=Math.abs(q-M),M=q));0<W.data.length&&(Y/=W.data.length-K),(A===void 0||U<=A)&&(V===void 0||V<Y)&&1.99<Y&&(A=U,j=re,V=Y)}return{successful:!!(e.delimiter=j),bestDelimiter:j}})(w,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=g.bestDelimiter:(l=!0,e.delimiter=a.DefaultDelimiter),d.meta.delimiter=e.delimiter),le(e));return e.preview&&e.header&&g.preview++,t=w,n=new ue(g),d=n.parse(t,k,T),P(),z?{meta:{paused:!0}}:d||{meta:{paused:!1}}},this.paused=function(){return z},this.pause=function(){z=!0,n.abort(),t=C(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){E.streamer._halted?(z=!1,E.streamer.parseChunk(t,!0)):setTimeout(E.resume,3)},this.aborted=function(){return h},this.abort=function(){h=!0,n.abort(),d.meta.aborted=!0,C(e.complete)&&e.complete(d),t=""},this.guessLineEndings=function(v,g){v=v.substring(0,1048576);var g=new RegExp(ne(g)+"([^]*?)"+ne(g),"gm"),T=(v=v.replace(g,"")).split("\r"),g=v.split(`
`),v=1<g.length&&g[0].length<T[0].length;if(T.length===1||v)return`
`;for(var F=0,S=0;S<T.length;S++)T[S][0]===`
`&&F++;return F>=T.length/2?`\r
`:"\r"}}function ne(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ue(e){var t=(e=e||{}).delimiter,n=e.newline,l=e.comments,u=e.step,y=e.preview,O=e.fastMode,H=null,B=!1,E=e.quoteChar==null?'"':e.quoteChar,R=E;if(e.escapeChar!==void 0&&(R=e.escapeChar),(typeof t!="string"||-1<a.BAD_DELIMITERS.indexOf(t))&&(t=","),l===t)throw new Error("Comment character same as delimiter");l===!0?l="#":(typeof l!="string"||-1<a.BAD_DELIMITERS.indexOf(l))&&(l=!1),n!==`
`&&n!=="\r"&&n!==`\r
`&&(n=`
`);var f=0,z=!1;this.parse=function(h,b,d){if(typeof h!="string")throw new Error("Input must be a string");var I=h.length,P=t.length,L=n.length,$=l.length,w=C(u),k=[],T=[],g=[],v=f=0;if(!h)return U();if(O||O!==!1&&h.indexOf(E)===-1){for(var F=h.split(n),S=0;S<F.length;S++){if(g=F[S],f+=g.length,S!==F.length-1)f+=n.length;else if(d)return U();if(!l||g.substring(0,$)!==l){if(w){if(k=[],V(g.split(t)),Y(),z)return U()}else V(g.split(t));if(y&&y<=S)return k=k.slice(0,y),U(!0)}}return U()}for(var D=h.indexOf(t,f),m=h.indexOf(n,f),j=new RegExp(ne(R)+ne(E),"g"),A=h.indexOf(E,f);;)if(h[f]===E)for(A=f,f++;;){if((A=h.indexOf(E,A+1))===-1)return d||T.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:k.length,index:f}),q();if(A===I-1)return q(h.substring(f,A).replace(j,E));if(E===R&&h[A+1]===R)A++;else if(E===R||A===0||h[A-1]!==R){D!==-1&&D<A+1&&(D=h.indexOf(t,A+1));var M=ee((m=m!==-1&&m<A+1?h.indexOf(n,A+1):m)===-1?D:Math.min(D,m));if(h.substr(A+1+M,P)===t){g.push(h.substring(f,A).replace(j,E)),h[f=A+1+M+P]!==E&&(A=h.indexOf(E,f)),D=h.indexOf(t,f),m=h.indexOf(n,f);break}if(M=ee(m),h.substring(A+1+M,A+1+M+L)===n){if(g.push(h.substring(f,A).replace(j,E)),re(A+1+M+L),D=h.indexOf(t,f),A=h.indexOf(E,f),w&&(Y(),z))return U();if(y&&k.length>=y)return U(!0);break}T.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:k.length,index:f}),A++}}else if(l&&g.length===0&&h.substring(f,f+$)===l){if(m===-1)return U();f=m+L,m=h.indexOf(n,f),D=h.indexOf(t,f)}else if(D!==-1&&(D<m||m===-1))g.push(h.substring(f,D)),f=D+P,D=h.indexOf(t,f);else{if(m===-1)break;if(g.push(h.substring(f,m)),re(m+L),w&&(Y(),z))return U();if(y&&k.length>=y)return U(!0)}return q();function V(K){k.push(K),v=f}function ee(K){var W=0;return W=K!==-1&&(K=h.substring(A+1,K))&&K.trim()===""?K.length:W}function q(K){return d||(K===void 0&&(K=h.substring(f)),g.push(K),f=I,V(g),w&&Y()),U()}function re(K){f=K,V(g),g=[],m=h.indexOf(n,f)}function U(K){if(e.header&&!b&&k.length&&!B){var W=k[0],X=Object.create(null),ce=new Set(W);let Ee=!1;for(let te=0;te<W.length;te++){let Z=W[te];if(X[Z=C(e.transformHeader)?e.transformHeader(Z,te):Z]){let ie,be=X[Z];for(;ie=Z+"_"+be,be++,ce.has(ie););ce.add(ie),W[te]=ie,X[Z]++,Ee=!0,(H=H===null?{}:H)[ie]=Z}else X[Z]=1,W[te]=Z;ce.add(Z)}Ee&&console.warn("Duplicate headers found and renamed."),B=!0}return{data:k,errors:T,meta:{delimiter:t,linebreak:n,aborted:z,truncated:!!K,cursor:v+(b||0),renamedHeaders:H}}}function Y(){u(U()),k=[],T=[]}},this.abort=function(){z=!0},this.getCharIndex=function(){return f}}function De(e){var t=e.data,n=p[t.workerId],l=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var u={abort:function(){l=!0,ge(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:me,resume:me};if(C(n.userStep)){for(var y=0;y<t.results.data.length&&(n.userStep({data:t.results.data[y],errors:t.results.errors,meta:t.results.meta},u),!l);y++);delete t.results}else C(n.userChunk)&&(n.userChunk(t.results,u,t.file),delete t.results)}t.finished&&!l&&ge(t.workerId,t.results)}function ge(e,t){var n=p[e];C(n.userComplete)&&n.userComplete(t),n.terminate(),delete p[e]}function me(){throw new Error("Not implemented.")}function le(e){if(typeof e!="object"||e===null)return e;var t,n=Array.isArray(e)?[]:{};for(t in e)n[t]=le(e[t]);return n}function J(e,t){return function(){e.apply(t,arguments)}}function C(e){return typeof e=="function"}return a.parse=function(e,t){var n=(t=t||{}).dynamicTyping||!1;if(C(n)&&(t.dynamicTypingFunction=n,n={}),t.dynamicTyping=n,t.transform=!!C(t.transform)&&t.transform,!t.worker||!a.WORKERS_SUPPORTED)return n=null,a.NODE_STREAM_INPUT,typeof e=="string"?(e=(l=>l.charCodeAt(0)!==65279?l:l.slice(1))(e),n=new(t.download?N:Q)(t)):e.readable===!0&&C(e.read)&&C(e.on)?n=new oe(t):(r.File&&e instanceof File||e instanceof Object)&&(n=new G(t)),n.stream(e);(n=(()=>{var l;return!!a.WORKERS_SUPPORTED&&(l=(()=>{var u=r.URL||r.webkitURL||null,y=c.toString();return a.BLOB_URL||(a.BLOB_URL=u.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",y,")();"],{type:"text/javascript"})))})(),(l=new r.Worker(l)).onmessage=De,l.id=x++,p[l.id]=l)})()).userStep=t.step,n.userChunk=t.chunk,n.userComplete=t.complete,n.userError=t.error,t.step=C(t.step),t.chunk=C(t.chunk),t.complete=C(t.complete),t.error=C(t.error),delete t.worker,n.postMessage({input:e,config:t,workerId:n.id})},a.unparse=function(e,t){var n=!1,l=!0,u=",",y=`\r
`,O='"',H=O+O,B=!1,E=null,R=!1,f=((()=>{if(typeof t=="object"){if(typeof t.delimiter!="string"||a.BAD_DELIMITERS.filter(function(b){return t.delimiter.indexOf(b)!==-1}).length||(u=t.delimiter),typeof t.quotes!="boolean"&&typeof t.quotes!="function"&&!Array.isArray(t.quotes)||(n=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(B=t.skipEmptyLines),typeof t.newline=="string"&&(y=t.newline),typeof t.quoteChar=="string"&&(O=t.quoteChar),typeof t.header=="boolean"&&(l=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");E=t.columns}t.escapeChar!==void 0&&(H=t.escapeChar+O),t.escapeFormulae instanceof RegExp?R=t.escapeFormulae:typeof t.escapeFormulae=="boolean"&&t.escapeFormulae&&(R=/^[=+\-@\t\r].*$/)}})(),new RegExp(ne(O),"g"));if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return z(null,e,B);if(typeof e[0]=="object")return z(E||Object.keys(e[0]),e,B)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||E),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:typeof e.data[0]=="object"?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||typeof e.data[0]=="object"||(e.data=[e.data])),z(e.fields||[],e.data||[],B);throw new Error("Unable to serialize unrecognized input");function z(b,d,I){var P="",L=(typeof b=="string"&&(b=JSON.parse(b)),typeof d=="string"&&(d=JSON.parse(d)),Array.isArray(b)&&0<b.length),$=!Array.isArray(d[0]);if(L&&l){for(var w=0;w<b.length;w++)0<w&&(P+=u),P+=h(b[w],w);0<d.length&&(P+=y)}for(var k=0;k<d.length;k++){var T=(L?b:d[k]).length,g=!1,v=L?Object.keys(d[k]).length===0:d[k].length===0;if(I&&!L&&(g=I==="greedy"?d[k].join("").trim()==="":d[k].length===1&&d[k][0].length===0),I==="greedy"&&L){for(var F=[],S=0;S<T;S++){var D=$?b[S]:S;F.push(d[k][D])}g=F.join("").trim()===""}if(!g){for(var m=0;m<T;m++){0<m&&!v&&(P+=u);var j=L&&$?b[m]:m;P+=h(d[k][j],m)}k<d.length-1&&(!I||0<T&&!v)&&(P+=y)}}return P}function h(b,d){var I,P;return b==null?"":b.constructor===Date?JSON.stringify(b).slice(1,25):(P=!1,R&&typeof b=="string"&&R.test(b)&&(b="'"+b,P=!0),I=b.toString().replace(f,H),(P=P||n===!0||typeof n=="function"&&n(b,d)||Array.isArray(n)&&n[d]||((L,$)=>{for(var w=0;w<$.length;w++)if(-1<L.indexOf($[w]))return!0;return!1})(I,a.BAD_DELIMITERS)||-1<I.indexOf(u)||I.charAt(0)===" "||I.charAt(I.length-1)===" ")?O+I+O:I)}},a.RECORD_SEP="",a.UNIT_SEP="",a.BYTE_ORDER_MARK="\uFEFF",a.BAD_DELIMITERS=["\r",`
`,'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!i&&!!r.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=ue,a.ParserHandle=ye,a.NetworkStreamer=N,a.FileStreamer=G,a.StringStreamer=Q,a.ReadableStreamStreamer=oe,r.jQuery&&((s=r.jQuery).fn.parse=function(e){var t=e.config||{},n=[];return this.each(function(y){if(!(s(this).prop("tagName").toUpperCase()==="INPUT"&&s(this).attr("type").toLowerCase()==="file"&&r.FileReader)||!this.files||this.files.length===0)return!0;for(var O=0;O<this.files.length;O++)n.push({file:this.files[O],inputElem:this,instanceConfig:s.extend({},t)})}),l(),this;function l(){if(n.length===0)C(e.complete)&&e.complete();else{var y,O,H,B,E=n[0];if(C(e.before)){var R=e.before(E.file,E.inputElem);if(typeof R=="object"){if(R.action==="abort")return y="AbortError",O=E.file,H=E.inputElem,B=R.reason,void(C(e.error)&&e.error({name:y},O,H,B));if(R.action==="skip")return void u();typeof R.config=="object"&&(E.instanceConfig=s.extend(E.instanceConfig,R.config))}else if(R==="skip")return void u()}var f=E.instanceConfig.complete;E.instanceConfig.complete=function(z){C(f)&&f(z,E.file,E.inputElem),u()},a.parse(E.file,E.instanceConfig)}}function u(){n.splice(0,1),l()}}),o&&(r.onmessage=function(e){e=e.data,a.WORKER_ID===void 0&&e&&(a.WORKER_ID=e.workerId),typeof e.input=="string"?r.postMessage({workerId:a.WORKER_ID,results:a.parse(e.input,e.config),finished:!0}):(r.File&&e.input instanceof File||e.input instanceof Object)&&(e=a.parse(e.input,e.config))&&r.postMessage({workerId:a.WORKER_ID,results:e,finished:!0})}),(N.prototype=Object.create(_.prototype)).constructor=N,(G.prototype=Object.create(_.prototype)).constructor=G,(Q.prototype=Object.create(Q.prototype)).constructor=Q,(oe.prototype=Object.create(_.prototype)).constructor=oe,a})});var Ie=Oe(_e());function pe(c,r){let s=Symbol(),i=c;return()=>(i[s]??=r(),i[s])}async function ke(c,r,s,i){let o=c[Symbol.iterator](),p=0,x=!1;for(;!x;){for(let a=0;a<r;a++){let _=o.next();if(_.done){x=!0;break}s(_.value,p),p++}i?.(),await new Promise(a=>setTimeout(a,0))}}var Xe=Object.freeze([]),Ve=Symbol("DataView header"),Ge=Symbol("DataView data offset");function Fe(c,r){let s=String(c).replace(/\s+/g,"");return`get${s.slice(0,1).toUpperCase()+s.slice(1)}${r}`}function Ke(c,r,s){let i=c.keyMapping[r];if(i===void 0)return()=>{};if(s==="At"){let{data:o,offset:p}=c;return x=>(o[x+p]??{})[i]}return o=>o[i]}function Ne(c,r){let s=["At","For"];for(let i of r)for(let o of s){let p=Fe(i,o),x=Ke(c,i,o);c[p]=x}}function Le(c,...r){let[s]=r.filter(o=>o!==void 0),i=s[Ve];return i===void 0?Object.entries(s):Array.isArray(c.at(0))?i.map((o,p)=>[o,p]):i.map(o=>[o,o])}function xe(c){class r{constructor(i,o,p=0){this.data=i;this.keyMapping=o;this.offset=p;this.keys=c;this.at=i=>this.data[this.offset+i];this.getPropertyAt=(i,o)=>this.getPropertyFor(this.data[this.offset+i]??{},o);this.getPropertyFor=(i,o)=>{let p=this.keyMapping[o];if(p!==void 0)return i[p]};this.materializeAt=(i,o)=>this.materializeFor(this.at(i),o);this.materializeFor=(i,o)=>{let p=Le(this,o,this.keyMapping),x={};for(let[a,_]of p)x[a]=i[_];return x};this.length=i.length-p,Ne(this,this.keys)}[Symbol.iterator](){let i=this.data[Symbol.iterator]();for(let o=0;o<this.offset;o++)i.next();return i}}return r}var ze=["Cell Type","X","Y"],je=["Cell Ontology ID","Z"],Ue=xe([...ze,...je]),se=class extends Ue{constructor(){super(...arguments);this.getPositionAt=(s,i)=>this.getPositionFor(this.at(s),i);this.getPositionFor=(s,i)=>{let o=i?.target??new Array(3);return o[0]=this.getXFor(s),o[1]=this.getYFor(s),o[2]=this.getZFor(s)??0,o};this.getDimensions=pe(this,()=>{let s=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let o of this){let p=this.getXFor(o),x=this.getYFor(o),a=this.getZFor(o)??0;s=Math.min(s,p,x,a),i=Math.max(i,p,x,a)}return[s,i]});this.getCounts=pe(this,()=>{let s={};for(let i of this){let o=this.getCellTypeFor(i);s[o]??=0,s[o]+=1}return new Map(Object.entries(s))});this.createFilter=s=>(i,o)=>s.includes(this.getCellTypeFor(i),o);this.createReindexer=async s=>{let o=[],p=-1;return await ke(this,2e4,(x,a)=>{let _=s.includes(this.getCellTypeFor(x),a);p+=Number(_),o.push(p)}),o}}},lt=new se([],{"Cell Type":0,X:1,Y:2});var We=[[-1,-1],[-1,0],[-1,1],[1,-1],[1,0],[1,1],[0,-1],[0,0],[0,1]],ae=class{constructor(){this.grid={}}addCellAt(r,s,i){this.ensureCellsExistsAt(r,s).push(i)}getCellsAt(r,s){return this.grid[r]?.[s]}*getNonEmptyIndices(){for(let r in this.grid)for(let s in this.grid[r])yield[+r,+s]}*getNeighborhood(r,s){for(let[i,o]of We){let p=this.getCellsAt(r+i,s+o);p!==void 0&&(yield*p)}}ensureCellsExistsAt(r,s){return this.grid[r]??={},this.grid[r][s]??=[],this.grid[r][s]}};function He(c,r,s){let i=new ae,o=new ae,p=0;for(let x of c){let a=c.getCellTypeFor(x),_={index:p,type:a,x:c.getXFor(x),y:c.getYFor(x),z:c.getZFor(x)??0,object:x},N=a===r?o:i,G=Math.floor(_.x/s),Q=Math.floor(_.y/s);N.addCellAt(G,Q,_),p++}return{sourceCells:i,targetCells:o}}function Be(c,r){let s=c.x-r.x,i=c.y-r.y,o=c.z-r.z;return s*s+i*i+o*o}function $e(c,r,s){let i=s*s,o;for(let p of r){let x=Be(c,p);x<i&&(i=x,o=p)}return o}function*Ae(c,r,s){let{sourceCells:i,targetCells:o}=He(c,r,s);if(Object.keys(o).length===0){console.warn(`No target cells found using selector '${r}'`);return}for(let[p,x]of i.getNonEmptyIndices()){let a=Array.from(o.getNeighborhood(p,x));for(let _ of i.getCellsAt(p,x)??[]){let N=$e(_,a,s);N!==void 0&&(yield{"Cell ID":_.index,"Target ID":N.index,X1:_.x,Y1:_.y,Z1:_.z,X2:N.x,Y2:N.y,Z2:N.z})}}}var dt=new Intl.DateTimeFormat(void 0,{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3});function he(c,r){return{type:"progress",processed:c,total:r,timestamp:Date.now()}}function qe(c){return{type:"result",edges:{data:c,keyMapping:{"Cell ID":"Cell ID","Target ID":"Target ID",X1:"X1",Y1:"Y1",Z1:"Z1",X2:"X2",Y2:"Y2",Z2:"Z2"},offset:0}}}addEventListener("message",c=>{let{nodes:{data:r,keyMapping:s,offset:i},targetSelector:o,maxDistance:p,reportStep:x=Math.floor(r.length/20)}=c.data,a=new se(r,s,i),{length:_}=a,N=[];postMessage(he(0,_));for(let G of Ae(a,o,p))N.push(G),N.length%x===0&&postMessage(he(N.length,_));postMessage(he(_,_)),postMessage(qe(N))});
