<ng-container hraFeature="eui.body-ui.spatial-search">
  <div class="spatial-search-scene">
    <div class="primary-scene-wrapper">
      <hra-body-ui
        hraFeature="scene"
        hraClickEvent
        hraClickEventTriggerOn="none"
        hraHoverEvent
        hraHoverEventTriggerOn="none"
        class="primary-scene"
        [scene]="scene()"
        [bounds]="sceneBounds()"
        [target]="sceneTarget()"
        (nodeClick)="nodeClicked.emit($event.node); sceneEvent.logEvent('click')"
        (nodeHoverStart)="sceneHoverEvent.logEvent('mouseenter')"
        (rotationChange)="rotation.set($event)"
        #primary
        #sceneEvent="hraClickEvent"
        #sceneHoverEvent="hraHoverEvent"
      ></hra-body-ui>
    </div>
    <div class="sidebar">
      <hra-body-ui
        hraFeature="minimap"
        hraClickEvent
        hraClickEventTriggerOn="none"
        hraHoverEvent
        hraHoverEventTriggerOn="none"
        class="minimap-scene"
        [interactive]="false"
        [scene]="scene()"
        [bounds]="sceneBounds()"
        [target]="sceneTarget()"
        [rotation]="rotation()[0]"
        [rotationX]="rotation()[1]"
        (nodeClick)="nodeClicked.emit($event.node); minimapEvent.logEvent('click')"
        (nodeHoverStart)="minimapHoverEvent.logEvent('mouseenter')"
        #minimap
        #minimapEvent="hraClickEvent"
        #minimapHoverEvent="hraHoverEvent"
      ></hra-body-ui>
      <ccf-spatial-search-keyboard-ui-behavior
        [delta]="1"
        [shiftDelta]="2"
        [position]="position()"
        (changePosition)="positionChange.emit($event)"
      ></ccf-spatial-search-keyboard-ui-behavior>
      <ccf-xyz-position [x]="position().x" [y]="position().y" [z]="position().z"></ccf-xyz-position>
    </div>
  </div>

  <div class="info-panel">
    <div class="header">
      <span class="title">Configure Spatial Search</span>
      <hra-help-button action="https://humanatlas.io/exploration-user-interface#using-spatial-search"></hra-help-button>
      <div style="flex-grow: 1"></div>
      <button
        hraFeature="close"
        hraClickEvent
        mat-icon-button
        hraIconButtonSize="large"
        disableRipple
        (click)="closeSpatialSearch.emit()"
        hraPlainTooltip="Close"
      >
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div hraFeature="organ-sex-selection" class="organ-sex-selection">
      <ccf-spatial-search-inputs
        [organs]="organs()"
        [sex]="sex()"
        [selectedOrgan]="referenceOrgan()"
        (updateOrgan)="updateOrgan.emit($event)"
        (updateSex)="updateSex.emit($event)"
      ></ccf-spatial-search-inputs>
    </div>
    <div class="radius-slider">
      <div
        class="slider-title"
        hraPlainTooltip="The probing sphere is a radius detecting registered tissue blocks and reports predicted anatomical structures and cell types."
      >
        Probing Sphere Size
      </div>
      <div class="slider-container">
        <mat-slider
          hraFeature="radius-slider"
          hraClickEvent
          class="slider"
          discrete
          [max]="radiusSettings().max"
          [min]="radiusSettings().min"
        >
          <input matSliderThumb [value]="radius()" (input)="radiusChange.emit(+slider.value)" #slider />
        </mat-slider>
        <span class="radius-value">{{ radius() }} mm</span>
      </div>
    </div>
    <div hraFeature="results" class="results">
      <ccf-tissue-block-list
        hraFeature="tissue-blocks"
        hraHoverEvent
        class="tissue-block list"
        [tissueBlocks]="tissueBlocks()"
        title="Tissue Blocks"
        toolTipText="Total quantity of registered tissue blocks detected by the probing sphere."
      ></ccf-tissue-block-list>
      <ccf-term-occurrence-list
        hraFeature="anatomical-structures"
        hraHoverEvent
        class="anatomical-structures list"
        [termList]="anatomicalStructures()"
        title="Anatomical Structure Predictions"
        toolTipText="Total quantity of predicted anatomical structures detected by the probing sphere."
      >
      </ccf-term-occurrence-list>
      <ccf-term-occurrence-list
        hraFeature="cell-types"
        hraHoverEvent
        class="cell-type list"
        [termList]="cellTypes()"
        title="Cell Type Predictions"
        toolTipText="Total quantity of predicted cell types detected by the probing sphere."
      ></ccf-term-occurrence-list>
    </div>

    <div hraFeature="buttons" class="button-container">
      <button hraFeature="reset-options" hraClickEvent mat-button [matMenuTriggerFor]="menu">
        Reset Options<mat-icon class="reset icon">reset_settings</mat-icon>
      </button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="resetSphere.emit()">
          <mat-icon hraFeature="reset-probing-sphere" hraClickEvent class="reset icon">reset_settings</mat-icon>
          Reset probing sphere size
        </button>
        <button hraFeature="reset-camera" hraClickEvent mat-menu-item (click)="resetView()">
          <mat-icon class="reset icon">reset_settings</mat-icon>
          Reset camera view
        </button>
        <button hraFeature="reset-position" hraClickEvent mat-menu-item (click)="resetPosition.emit()">
          <mat-icon class="reset icon">reset_settings</mat-icon>
          Reset position
        </button>
        <mat-divider></mat-divider>
        <button
          hraFeature="reset-all"
          hraClickEvent
          mat-menu-item
          (click)="resetSphere.emit(); resetPosition.emit(); resetView()"
        >
          <mat-icon class="reset icon">reset_settings</mat-icon>
          Reset all settings
        </button>
      </mat-menu>
      <button
        hraFeature="apply"
        hraClickEvent
        mat-flat-button
        class="run-spatial-search button"
        (click)="addSpatialSearch.emit()"
        [disabled]="tissueBlocks().length === 0"
      >
        Apply
      </button>
    </div>
  </div>
</ng-container>
