<mat-form-field subscriptSizing="dynamic">
  <div class="chips-area">
    <mat-chip-grid #chipGrid aria-label="Option selection" [formControl]="form()">
      @for (option of options(); track option) {
        <mat-chip-row (removed)="remove(option)">
          {{ option }}
          <button matChipRemove [attr.aria-label]="'remove ' + option">
            <mat-icon>close</mat-icon>
          </button>
        </mat-chip-row>
      }
    </mat-chip-grid>
    @if (options().length > 0) {
      <button mat-icon-button (click)="options.set([])"><mat-icon>delete</mat-icon></button>
    }
  </div>
  <mat-label>{{ label() }}</mat-label>
  <div class="search-area">
    <input
      placeholder="Search"
      #searchInput
      [(ngModel)]="currentInputValue"
      [matChipInputFor]="chipGrid"
      [matAutocomplete]="auto"
      [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
      (matChipInputTokenEnd)="add($event)"
    />
  </div>
  <mat-autocomplete
    #auto="matAutocomplete"
    autoActiveFirstOption
    autoSelectActiveOption
    (optionSelected)="selected($event); searchInput.value = ''"
  >
    @for (option of filteredOptions(); track option) {
      <mat-option [value]="option">{{ option }}</mat-option>
    }
  </mat-autocomplete>
</mat-form-field>
