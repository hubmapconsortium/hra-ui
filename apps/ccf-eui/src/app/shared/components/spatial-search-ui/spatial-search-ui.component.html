<div class="spatial-search-scene">
  <div class="primary-scene-wrapper">
    <ccf-body-ui
      #primary
      class="primary-scene"
      [scene]="scene"
      [bounds]="sceneBounds"
      [target]="sceneTarget"
      (nodeClick)="nodeClicked.emit($event.node)"
      (rotationChange)="minimap.rotation = $event[0]; minimap.rotationX = $event[1]"
    ></ccf-body-ui>
  </div>
  <div class="sidebar">
    <ccf-body-ui
      #minimap
      class="minimap-scene"
      [interactive]="false"
      [scene]="scene"
      [bounds]="sceneBounds"
      [target]="sceneTarget"
      (nodeClick)="nodeClicked.emit($event.node)"
    ></ccf-body-ui>
    <ccf-spatial-search-keyboard-ui-behavior
      [delta]="1"
      [shiftDelta]="2"
      [position]="position"
      (changePosition)="positionChange.emit($event)"
    ></ccf-spatial-search-keyboard-ui-behavior>
    <ccf-xyz-position [x]="position.x" [y]="position.y" [z]="position.z"></ccf-xyz-position>
  </div>
</div>

<div class="info-panel">
  <div class="header">
    <span class="title">Configure Spatial Search</span>
    <button class="help" mat-icon-button (click)="infoClicked.emit()">
      <mat-icon>help</mat-icon>
    </button>
    <div style="flex-grow: 1"></div>
    <button mat-icon-button hraIconButtonSize="large" disableRipple (click)="closeSpatialSearch.emit()">
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <div class="organ-sex-selection">
    <!-- <div class="sex">
      <div class="label">Donor Sex:</div>
      <div class="current-sex">{{ sex.charAt(0).toUpperCase() + sex.slice(1) }}</div>
    </div>
    <div class="organ">
      <div class="label">Organ:</div>
      <div class="current-organ">{{ referenceOrgan.name }}</div>
    </div> -->

    <div class="sex-toggle">
      <mat-form-field class="sex-field" subscriptSizing="dynamic">
        <mat-label>Donor Sex</mat-label>
        <mat-select
          panelClass="options-container"
          disableOptionCentering="true"
          disableRipple
          [(value)]="sex"
          (selectionChange)="updateSex.emit($event.value)"
        >
          @for (option of ['both', 'male', 'female']; track option) {
            <mat-option class="dropdown-option" [value]="option">
              <div>{{ option.charAt(0).toUpperCase() + option.slice(1) }}</div>
            </mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>

    <div class="organ-selector">
      <form class="organ-selector">
        <mat-form-field class="organ-field" subscriptSizing="dynamic">
          <mat-label>Organ</mat-label>
          <mat-icon class="search-icon" matPrefix>search</mat-icon>
          <input
            matInput
            hideSingleSelectionIndicator="true"
            type="text"
            placeholder="Organ"
            aria-label="Organ"
            [formControl]="organControl"
            [matAutocomplete]="auto"
          />
          <mat-autocomplete
            #auto="matAutocomplete"
            [displayWith]="displayFn"
            (optionSelected)="updateOrgan.emit($event.option.value); referenceOrgan = $event.option.value"
          >
            @for (organ of filteredOrgans | async; track organ) {
              <mat-option [value]="organ">{{ organ.name }}</mat-option>
            }
          </mat-autocomplete>
        </mat-form-field>
      </form>
    </div>
  </div>
  <div class="radius-slider">
    <div class="slider-title">Search Radius Size</div>
    <div class="slider-container">
      <mat-slider class="slider" [max]="radiusSettings.max" [min]="radiusSettings.min">
        <input matSliderThumb [value]="radius" (input)="radiusChange.emit(+slider.value)" #slider />
      </mat-slider>
      <span class="radius-value">{{ radius }} mm</span>
    </div>
  </div>
  <div class="results">
    <ccf-tissue-block-list class="tissue-block list" [tissueBlocks]="tissueBlocks"></ccf-tissue-block-list>
    <ccf-term-occurrence-list
      class="anatomical-structures list"
      [termList]="anatomicalStructures"
      title="Anatomical Structure Predictions"
      toolTipText="Total quantity of predicted anatomical structures detected by the Probing Sphere"
    >
    </ccf-term-occurrence-list>
    <ccf-term-occurrence-list
      class="cell-type list"
      [termList]="cellTypes"
      title="Cell Type Predictions"
      toolTipText="Total quantity of predicted cell types detected by the Probing Sphere"
    ></ccf-term-occurrence-list>
  </div>

  <div class="button-container">
    <button mat-button>Reset Filters<mat-icon class="reset icon" svgIcon="reset_wrench"></mat-icon></button>
    <button
      mat-flat-button
      class="run-spatial-search button"
      (click)="addSpatialSearch.emit()"
      [disabled]="tissueBlocks.length === 0"
    >
      Apply
    </button>
  </div>
</div>
