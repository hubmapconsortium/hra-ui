var Te=Object.create;var we=Object.defineProperty;var Se=Object.getOwnPropertyDescriptor;var Me=Object.getOwnPropertyNames;var Oe=Object.getPrototypeOf,Pe=Object.prototype.hasOwnProperty;var Re=(d,n)=>()=>(n||d((n={exports:{}}).exports,n),n.exports);var Ie=(d,n,i,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let u of Me(n))!Pe.call(d,u)&&u!==i&&we(d,u,{get:()=>n[u],enumerable:!(o=Se(n,u))||o.enumerable});return d};var Ve=(d,n,i)=>(i=d!=null?Te(Oe(d)):{},Ie(n||!d||!d.__esModule?we(i,"default",{value:d,enumerable:!0}):i,d));var ve=Re((he,ye)=>{"use strict";(function(d,n){typeof ye=="object"&&typeof he<"u"?ye.exports=n():d.Papa=n()})(he,function d(){"use strict";var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},i=!n.document&&!!n.postMessage,o=n.IS_PAPA_WORKER||!1,u={},m=0,s={parse:function(t,e){var r=(e=e||{}).dynamicTyping||!1;if(k(r)&&(e.dynamicTypingFunction=r,r={}),e.dynamicTyping=r,e.transform=!!k(e.transform)&&e.transform,e.worker&&s.WORKERS_SUPPORTED){var a=function(){if(!s.WORKERS_SUPPORTED)return!1;var y=(N=n.URL||n.webkitURL||null,T=d.toString(),s.BLOB_URL||(s.BLOB_URL=N.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",T,")();"],{type:"text/javascript"})))),g=new n.Worker(y),N,T;return g.onmessage=De,g.id=m++,u[g.id]=g}();return a.userStep=e.step,a.userChunk=e.chunk,a.userComplete=e.complete,a.userError=e.error,e.step=k(e.step),e.chunk=k(e.chunk),e.complete=k(e.complete),e.error=k(e.error),delete e.worker,void a.postMessage({input:t,config:e,workerId:a.id})}var f=null;return s.NODE_STREAM_INPUT,typeof t=="string"?(t=function(y){return y.charCodeAt(0)===65279?y.slice(1):y}(t),f=e.download?new F(e):new re(e)):t.readable===!0&&k(t.read)&&k(t.on)?f=new ue(e):(n.File&&t instanceof File||t instanceof Object)&&(f=new G(e)),f.stream(t)},unparse:function(t,e){var r=!1,a=!0,f=",",y=`\r
`,g='"',N=g+g,T=!1,c=null,M=!1;(function(){if(typeof e=="object"){if(typeof e.delimiter!="string"||s.BAD_DELIMITERS.filter(function(l){return e.delimiter.indexOf(l)!==-1}).length||(f=e.delimiter),(typeof e.quotes=="boolean"||typeof e.quotes=="function"||Array.isArray(e.quotes))&&(r=e.quotes),typeof e.skipEmptyLines!="boolean"&&typeof e.skipEmptyLines!="string"||(T=e.skipEmptyLines),typeof e.newline=="string"&&(y=e.newline),typeof e.quoteChar=="string"&&(g=e.quoteChar),typeof e.header=="boolean"&&(a=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");c=e.columns}e.escapeChar!==void 0&&(N=e.escapeChar+g),(typeof e.escapeFormulae=="boolean"||e.escapeFormulae instanceof RegExp)&&(M=e.escapeFormulae instanceof RegExp?e.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var h=new RegExp(oe(g),"g");if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return q(null,t,T);if(typeof t[0]=="object")return q(c||Object.keys(t[0]),t,T)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||c),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),q(t.fields||[],t.data||[],T);throw new Error("Unable to serialize unrecognized input");function q(l,x,z){var S="";typeof l=="string"&&(l=JSON.parse(l)),typeof x=="string"&&(x=JSON.parse(x));var K=Array.isArray(l)&&0<l.length,I=!Array.isArray(x[0]);if(K&&a){for(var V=0;V<l.length;V++)0<V&&(S+=f),S+=L(l[V],V);0<x.length&&(S+=y)}for(var p=0;p<x.length;p++){var b=K?l.length:x[p].length,A=!1,R=K?Object.keys(x[p]).length===0:x[p].length===0;if(z&&!K&&(A=z==="greedy"?x[p].join("").trim()==="":x[p].length===1&&x[p][0].length===0),z==="greedy"&&K){for(var w=[],W=0;W<b;W++){var O=I?l[W]:W;w.push(x[p][O])}A=w.join("").trim()===""}if(!A){for(var v=0;v<b;v++){0<v&&!R&&(S+=f);var $=K&&I?l[v]:v;S+=L(x[p][$],v)}p<x.length-1&&(!z||0<b&&!R)&&(S+=y)}}return S}function L(l,x){if(l==null)return"";if(l.constructor===Date)return JSON.stringify(l).slice(1,25);var z=!1;M&&typeof l=="string"&&M.test(l)&&(l="'"+l,z=!0);var S=l.toString().replace(h,N);return(z=z||r===!0||typeof r=="function"&&r(l,x)||Array.isArray(r)&&r[x]||function(K,I){for(var V=0;V<I.length;V++)if(-1<K.indexOf(I[V]))return!0;return!1}(S,s.BAD_DELIMITERS)||-1<S.indexOf(f)||S.charAt(0)===" "||S.charAt(S.length-1)===" ")?g+S+g:S}}};if(s.RECORD_SEP="",s.UNIT_SEP="",s.BYTE_ORDER_MARK="\uFEFF",s.BAD_DELIMITERS=["\r",`
`,'"',s.BYTE_ORDER_MARK],s.WORKERS_SUPPORTED=!i&&!!n.Worker,s.NODE_STREAM_INPUT=1,s.LocalChunkSize=10485760,s.RemoteChunkSize=5242880,s.DefaultDelimiter=",",s.Parser=ce,s.ParserHandle=Ee,s.NetworkStreamer=F,s.FileStreamer=G,s.StringStreamer=re,s.ReadableStreamStreamer=ue,n.jQuery){var C=n.jQuery;C.fn.parse=function(t){var e=t.config||{},r=[];return this.each(function(y){if(!(C(this).prop("tagName").toUpperCase()==="INPUT"&&C(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var g=0;g<this.files.length;g++)r.push({file:this.files[g],inputElem:this,instanceConfig:C.extend({},e)})}),a(),this;function a(){if(r.length!==0){var y,g,N,T,c=r[0];if(k(t.before)){var M=t.before(c.file,c.inputElem);if(typeof M=="object"){if(M.action==="abort")return y="AbortError",g=c.file,N=c.inputElem,T=M.reason,void(k(t.error)&&t.error({name:y},g,N,T));if(M.action==="skip")return void f();typeof M.config=="object"&&(c.instanceConfig=C.extend(c.instanceConfig,M.config))}else if(M==="skip")return void f()}var h=c.instanceConfig.complete;c.instanceConfig.complete=function(q){k(h)&&h(q,c.file,c.inputElem),f()},s.parse(c.file,c.instanceConfig)}else k(t.complete)&&t.complete()}function f(){r.splice(0,1),a()}}}function E(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(e){var r=de(e);r.chunkSize=parseInt(r.chunkSize),e.step||e.chunk||(r.chunkSize=null),this._handle=new Ee(r),(this._handle.streamer=this)._config=r}).call(this,t),this.parseChunk=function(e,r){if(this.isFirstChunk&&k(this._config.beforeFirstChunk)){var a=this._config.beforeFirstChunk(e);a!==void 0&&(e=a)}this.isFirstChunk=!1,this._halted=!1;var f=this._partialLine+e;this._partialLine="";var y=this._handle.parse(f,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var g=y.meta.cursor;this._finished||(this._partialLine=f.substring(g-this._baseIndex),this._baseIndex=g),y&&y.data&&(this._rowCount+=y.data.length);var N=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(o)n.postMessage({results:y,workerId:s.WORKER_ID,finished:N});else if(k(this._config.chunk)&&!r){if(this._config.chunk(y,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);y=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(y.data),this._completeResults.errors=this._completeResults.errors.concat(y.errors),this._completeResults.meta=y.meta),this._completed||!N||!k(this._config.complete)||y&&y.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),N||y&&y.meta.paused||this._nextChunk(),y}this._halted=!0},this._sendError=function(e){k(this._config.error)?this._config.error(e):o&&this._config.error&&n.postMessage({workerId:s.WORKER_ID,error:e,finished:!1})}}function F(t){var e;(t=t||{}).chunkSize||(t.chunkSize=s.RemoteChunkSize),E.call(this,t),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(r){this._input=r,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(e=new XMLHttpRequest,this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),i||(e.onload=J(this._chunkLoaded,this),e.onerror=J(this._chunkError,this)),e.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var r=this._config.downloadRequestHeaders;for(var a in r)e.setRequestHeader(a,r[a])}if(this._config.chunkSize){var f=this._start+this._config.chunkSize-1;e.setRequestHeader("Range","bytes="+this._start+"-"+f)}try{e.send(this._config.downloadRequestBody)}catch(y){this._chunkError(y.message)}i&&e.status===0&&this._chunkError()}},this._chunkLoaded=function(){e.readyState===4&&(e.status<200||400<=e.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:e.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(r){var a=r.getResponseHeader("Content-Range");return a===null?-1:parseInt(a.substring(a.lastIndexOf("/")+1))}(e),this.parseChunk(e.responseText)))},this._chunkError=function(r){var a=e.statusText||r;this._sendError(new Error(a))}}function G(t){var e,r;(t=t||{}).chunkSize||(t.chunkSize=s.LocalChunkSize),E.call(this,t);var a=typeof FileReader<"u";this.stream=function(f){this._input=f,r=f.slice||f.webkitSlice||f.mozSlice,a?((e=new FileReader).onload=J(this._chunkLoaded,this),e.onerror=J(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var f=this._input;if(this._config.chunkSize){var y=Math.min(this._start+this._config.chunkSize,this._input.size);f=r.call(f,this._start,y)}var g=e.readAsText(f,this._config.encoding);a||this._chunkLoaded({target:{result:g}})},this._chunkLoaded=function(f){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(f.target.result)},this._chunkError=function(){this._sendError(e.error)}}function re(t){var e;E.call(this,t=t||{}),this.stream=function(r){return e=r,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var r,a=this._config.chunkSize;return a?(r=e.substring(0,a),e=e.substring(a)):(r=e,e=""),this._finished=!e,this.parseChunk(r)}}}function ue(t){E.call(this,t=t||{});var e=[],r=!0,a=!1;this.pause=function(){E.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){E.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(f){this._input=f,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){a&&e.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),e.length?this.parseChunk(e.shift()):r=!0},this._streamData=J(function(f){try{e.push(typeof f=="string"?f:f.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(e.shift()))}catch(y){this._streamError(y)}},this),this._streamError=J(function(f){this._streamCleanUp(),this._sendError(f)},this),this._streamEnd=J(function(){this._streamCleanUp(),a=!0,this._streamData("")},this),this._streamCleanUp=J(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function Ee(t){var e,r,a,f=Math.pow(2,53),y=-f,g=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,N=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,T=this,c=0,M=0,h=!1,q=!1,L=[],l={data:[],errors:[],meta:{}};if(k(t.step)){var x=t.step;t.step=function(p){if(l=p,K())S();else{if(S(),l.data.length===0)return;c+=p.data.length,t.preview&&c>t.preview?r.abort():(l.data=l.data[0],x(l,T))}}}function z(p){return t.skipEmptyLines==="greedy"?p.join("").trim()==="":p.length===1&&p[0].length===0}function S(){return l&&a&&(V("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+s.DefaultDelimiter+"'"),a=!1),t.skipEmptyLines&&(l.data=l.data.filter(function(p){return!z(p)})),K()&&function(){if(!l)return;function p(A,R){k(t.transformHeader)&&(A=t.transformHeader(A,R)),L.push(A)}if(Array.isArray(l.data[0])){for(var b=0;K()&&b<l.data.length;b++)l.data[b].forEach(p);l.data.splice(0,1)}else l.data.forEach(p)}(),function(){if(!l||!t.header&&!t.dynamicTyping&&!t.transform)return l;function p(A,R){var w,W=t.header?{}:[];for(w=0;w<A.length;w++){var O=w,v=A[w];t.header&&(O=w>=L.length?"__parsed_extra":L[w]),t.transform&&(v=t.transform(v,O)),v=I(O,v),O==="__parsed_extra"?(W[O]=W[O]||[],W[O].push(v)):W[O]=v}return t.header&&(w>L.length?V("FieldMismatch","TooManyFields","Too many fields: expected "+L.length+" fields but parsed "+w,M+R):w<L.length&&V("FieldMismatch","TooFewFields","Too few fields: expected "+L.length+" fields but parsed "+w,M+R)),W}var b=1;return!l.data.length||Array.isArray(l.data[0])?(l.data=l.data.map(p),b=l.data.length):l.data=p(l.data,0),t.header&&l.meta&&(l.meta.fields=L),M+=b,l}()}function K(){return t.header&&L.length===0}function I(p,b){return A=p,t.dynamicTypingFunction&&t.dynamicTyping[A]===void 0&&(t.dynamicTyping[A]=t.dynamicTypingFunction(A)),(t.dynamicTyping[A]||t.dynamicTyping)===!0?b==="true"||b==="TRUE"||b!=="false"&&b!=="FALSE"&&(function(R){if(g.test(R)){var w=parseFloat(R);if(y<w&&w<f)return!0}return!1}(b)?parseFloat(b):N.test(b)?new Date(b):b===""?null:b):b;var A}function V(p,b,A,R){var w={type:p,code:b,message:A};R!==void 0&&(w.row=R),l.errors.push(w)}this.parse=function(p,b,A){var R=t.quoteChar||'"';if(t.newline||(t.newline=function(O,v){O=O.substring(0,1048576);var $=new RegExp(oe(v)+"([^]*?)"+oe(v),"gm"),U=(O=O.replace($,"")).split("\r"),Y=O.split(`
`),Z=1<Y.length&&Y[0].length<U[0].length;if(U.length===1||Z)return`
`;for(var j=0,D=0;D<U.length;D++)U[D][0]===`
`&&j++;return j>=U.length/2?`\r
`:"\r"}(p,R)),a=!1,t.delimiter)k(t.delimiter)&&(t.delimiter=t.delimiter(p),l.meta.delimiter=t.delimiter);else{var w=function(O,v,$,U,Y){var Z,j,D,P;Y=Y||[",","	","|",";",s.RECORD_SEP,s.UNIT_SEP];for(var ne=0;ne<Y.length;ne++){var _=Y[ne],se=0,X=0,ie=0;D=void 0;for(var Q=new ce({comments:U,delimiter:_,newline:v,preview:10}).parse(O),ee=0;ee<Q.data.length;ee++)if($&&z(Q.data[ee]))ie++;else{var te=Q.data[ee].length;X+=te,D!==void 0?0<te&&(se+=Math.abs(te-D),D=te):D=te}0<Q.data.length&&(X/=Q.data.length-ie),(j===void 0||se<=j)&&(P===void 0||P<X)&&1.99<X&&(j=se,Z=_,P=X)}return{successful:!!(t.delimiter=Z),bestDelimiter:Z}}(p,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess);w.successful?t.delimiter=w.bestDelimiter:(a=!0,t.delimiter=s.DefaultDelimiter),l.meta.delimiter=t.delimiter}var W=de(t);return t.preview&&t.header&&W.preview++,e=p,r=new ce(W),l=r.parse(e,b,A),S(),h?{meta:{paused:!0}}:l||{meta:{paused:!1}}},this.paused=function(){return h},this.pause=function(){h=!0,r.abort(),e=k(t.chunk)?"":e.substring(r.getCharIndex())},this.resume=function(){T.streamer._halted?(h=!1,T.streamer.parseChunk(e,!0)):setTimeout(T.resume,3)},this.aborted=function(){return q},this.abort=function(){q=!0,r.abort(),l.meta.aborted=!0,k(t.complete)&&t.complete(l),e=""}}function oe(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ce(t){var e,r=(t=t||{}).delimiter,a=t.newline,f=t.comments,y=t.step,g=t.preview,N=t.fastMode,T=e=t.quoteChar===void 0||t.quoteChar===null?'"':t.quoteChar;if(t.escapeChar!==void 0&&(T=t.escapeChar),(typeof r!="string"||-1<s.BAD_DELIMITERS.indexOf(r))&&(r=","),f===r)throw new Error("Comment character same as delimiter");f===!0?f="#":(typeof f!="string"||-1<s.BAD_DELIMITERS.indexOf(f))&&(f=!1),a!==`
`&&a!=="\r"&&a!==`\r
`&&(a=`
`);var c=0,M=!1;this.parse=function(h,q,L){if(typeof h!="string")throw new Error("Input must be a string");var l=h.length,x=r.length,z=a.length,S=f.length,K=k(y),I=[],V=[],p=[],b=c=0;if(!h)return H();if(t.header&&!q){var A=h.split(a)[0].split(r),R=[],w={},W=!1;for(var O in A){var v=A[O];k(t.transformHeader)&&(v=t.transformHeader(v,O));var $=v,U=w[v]||0;for(0<U&&(W=!0,$=v+"_"+U),w[v]=U+1;R.includes($);)$=$+"_"+U;R.push($)}if(W){var Y=h.split(a);Y[0]=R.join(r),h=Y.join(a)}}if(N||N!==!1&&h.indexOf(e)===-1){for(var Z=h.split(a),j=0;j<Z.length;j++){if(p=Z[j],c+=p.length,j!==Z.length-1)c+=a.length;else if(L)return H();if(!f||p.substring(0,S)!==f){if(K){if(I=[],ie(p.split(r)),le(),M)return H()}else ie(p.split(r));if(g&&g<=j)return I=I.slice(0,g),H(!0)}}return H()}for(var D=h.indexOf(r,c),P=h.indexOf(a,c),ne=new RegExp(oe(T)+oe(e),"g"),_=h.indexOf(e,c);;)if(h[c]!==e)if(f&&p.length===0&&h.substring(c,c+S)===f){if(P===-1)return H();c=P+z,P=h.indexOf(a,c),D=h.indexOf(r,c)}else if(D!==-1&&(D<P||P===-1))p.push(h.substring(c,D)),c=D+x,D=h.indexOf(r,c);else{if(P===-1)break;if(p.push(h.substring(c,P)),te(P+z),K&&(le(),M))return H();if(g&&I.length>=g)return H(!0)}else for(_=c,c++;;){if((_=h.indexOf(e,_+1))===-1)return L||V.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:I.length,index:c}),ee();if(_===l-1)return ee(h.substring(c,_).replace(ne,e));if(e!==T||h[_+1]!==T){if(e===T||_===0||h[_-1]!==T){D!==-1&&D<_+1&&(D=h.indexOf(r,_+1)),P!==-1&&P<_+1&&(P=h.indexOf(a,_+1));var se=Q(P===-1?D:Math.min(D,P));if(h.substr(_+1+se,x)===r){p.push(h.substring(c,_).replace(ne,e)),h[c=_+1+se+x]!==e&&(_=h.indexOf(e,c)),D=h.indexOf(r,c),P=h.indexOf(a,c);break}var X=Q(P);if(h.substring(_+1+X,_+1+X+z)===a){if(p.push(h.substring(c,_).replace(ne,e)),te(_+1+X+z),D=h.indexOf(r,c),_=h.indexOf(e,c),K&&(le(),M))return H();if(g&&I.length>=g)return H(!0);break}V.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:I.length,index:c}),_++}}else _++}return ee();function ie(B){I.push(B),b=c}function Q(B){var ke=0;if(B!==-1){var pe=h.substring(_+1,B);pe&&pe.trim()===""&&(ke=pe.length)}return ke}function ee(B){return L||(B===void 0&&(B=h.substring(c)),p.push(B),c=l,ie(p),K&&le()),H()}function te(B){c=B,ie(p),p=[],P=h.indexOf(a,c)}function H(B){return{data:I,errors:V,meta:{delimiter:r,linebreak:a,aborted:M,truncated:!!B,cursor:b+(q||0)}}}function le(){y(H()),I=[],V=[]}},this.abort=function(){M=!0},this.getCharIndex=function(){return c}}function De(t){var e=t.data,r=u[e.workerId],a=!1;if(e.error)r.userError(e.error,e.file);else if(e.results&&e.results.data){var f={abort:function(){a=!0,be(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:_e,resume:_e};if(k(r.userStep)){for(var y=0;y<e.results.data.length&&(r.userStep({data:e.results.data[y],errors:e.results.errors,meta:e.results.meta},f),!a);y++);delete e.results}else k(r.userChunk)&&(r.userChunk(e.results,f,e.file),delete e.results)}e.finished&&!a&&be(e.workerId,e.results)}function be(t,e){var r=u[t];k(r.userComplete)&&r.userComplete(e),r.terminate(),delete u[t]}function _e(){throw new Error("Not implemented.")}function de(t){if(typeof t!="object"||t===null)return t;var e=Array.isArray(t)?[]:{};for(var r in t)e[r]=de(t[r]);return e}function J(t,e){return function(){t.apply(e,arguments)}}function k(t){return typeof t=="function"}return o&&(n.onmessage=function(t){var e=t.data;if(s.WORKER_ID===void 0&&e&&(s.WORKER_ID=e.workerId),typeof e.input=="string")n.postMessage({workerId:s.WORKER_ID,results:s.parse(e.input,e.config),finished:!0});else if(n.File&&e.input instanceof File||e.input instanceof Object){var r=s.parse(e.input,e.config);r&&n.postMessage({workerId:s.WORKER_ID,results:r,finished:!0})}}),(F.prototype=Object.create(E.prototype)).constructor=F,(G.prototype=Object.create(E.prototype)).constructor=G,(re.prototype=Object.create(re.prototype)).constructor=re,(ue.prototype=Object.create(E.prototype)).constructor=ue,s})});var Fe=Ve(ve());function ge(d,n){let i=Symbol(),o=d;return()=>(o[i]??=n(),o[i])}async function xe(d,n,i,o){let u=d[Symbol.iterator](),m=0,s=!1;for(;!s;){for(let C=0;C<n;C++,m++){let E=u.next();if(E.done){s=!0;break}i(E.value,m)}o?.(),await new Promise(C=>setTimeout(C,0))}}function Ne(d,n){let i=String(d).replace(/\s+/g,"");return`get${i.slice(0,1).toUpperCase()+i.slice(1)}${n}`}function Ke(d,n,i){let o=d.keyMapping[n];if(o===void 0)return()=>{};if(i==="At"){let{data:u,offset:m}=d;return s=>(u[s+m]??{})[o]}else return u=>u[o]}function Le(d,n){let i=["At","For"];for(let o of n)for(let u of i){let m=Ne(o,u),s=Ke(d,o,u);d[m]=s}}function Ce(d){class n{constructor(o,u,m=0){this.data=o;this.keyMapping=u;this.offset=m;this.keys=d;this.at=o=>this.data[this.offset+o];this.getPropertyAt=(o,u)=>this.getPropertyFor(this.data[this.offset+o]??{},u);this.getPropertyFor=(o,u)=>{let m=this.keyMapping[u];if(m!==void 0)return o[m]};this.length=o.length-m,Le(this,this.keys)}[Symbol.iterator](){let o=this.data[Symbol.iterator]();for(let u=0;u<this.offset;u++)o.next();return o}}return n}var Xe=Symbol("DataView offset");var ze=["Cell Type","X","Y"],We=["Cell Ontology ID","Z"],Ue=Ce([...ze,...We]),ae=class extends Ue{constructor(){super(...arguments);this.getPositionAt=(i,o)=>this.getPositionFor(this.at(i),o);this.getPositionFor=(i,o)=>{let u=o?.target??new Array(3);return u[0]=this.getXFor(i),u[1]=this.getYFor(i),u[2]=this.getZFor(i)??0,u};this.getDimensions=ge(this,()=>{let i=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let u of this){let m=this.getXFor(u),s=this.getYFor(u),C=this.getZFor(u)??0;i=Math.min(i,m,s,C),o=Math.max(o,m,s,C)}return[i,o]});this.getCounts=ge(this,()=>{let i={};for(let o of this){let u=this.getCellTypeFor(o);i[u]??=0,i[u]+=1}return new Map(Object.entries(i))});this.createFilter=i=>(o,u)=>i.includes(this.getCellTypeFor(o),u);this.createReindexer=async i=>{let u=[],m=-1;return await xe(this,2e4,(s,C)=>{let E=i.includes(this.getCellTypeFor(s),C);m+=Number(E),u.push(m)}),u}}},ut=new ae([],{"Cell Type":0,X:1,Y:2});var je=[[-1,-1],[-1,0],[-1,1],[1,-1],[1,0],[1,1],[0,-1],[0,0],[0,1]],fe=class{constructor(){this.grid={}}addCellAt(n,i,o){this.ensureCellsExistsAt(n,i).push(o)}getCellsAt(n,i){return this.grid[n]?.[i]}*getNonEmptyIndices(){for(let n in this.grid)for(let i in this.grid[n])yield[+n,+i]}*getNeighborhood(n,i){for(let[o,u]of je){let m=this.getCellsAt(n+o,i+u);m!==void 0&&(yield*m)}}ensureCellsExistsAt(n,i){return this.grid[n]??={},this.grid[n][i]??=[],this.grid[n][i]}};function He(d,n,i){let o=new fe,u=new fe,m=0;for(let s of d){let C=d.getCellTypeFor(s),E={index:m,type:C,x:d.getXFor(s),y:d.getYFor(s),z:d.getZFor(s)??0,object:s},F=C===n?u:o,G=Math.floor(E.x/i),re=Math.floor(E.y/i);F.addCellAt(G,re,E),m++}return{sourceCells:o,targetCells:u}}function Be(d,n){let i=d.x-n.x,o=d.y-n.y,u=d.z-n.z;return i*i+o*o+u*u}function qe(d,n,i){let o=i*i,u;for(let m of n){let s=Be(d,m);s<o&&(o=s,u=m)}return u}function*Ae(d,n,i){let{sourceCells:o,targetCells:u}=He(d,n,i);if(Object.keys(u).length===0){console.warn(`No target cells found using selector '${n}'`);return}for(let[m,s]of o.getNonEmptyIndices()){let C=Array.from(u.getNeighborhood(m,s));for(let E of o.getCellsAt(m,s)??[]){let F=qe(E,C,i);F!==void 0&&(yield{"Cell ID":E.index,"Target ID":F.index,X1:E.x,Y1:E.y,Z1:E.z,X2:F.x,Y2:F.y,Z2:F.z})}}}var ft=new Intl.DateTimeFormat(void 0,{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3});function me(d,n){return{type:"progress",processed:d,total:n,timestamp:Date.now()}}function $e(d){return{type:"result",edges:{data:d,keyMapping:{"Cell ID":"Cell ID","Target ID":"Target ID",X1:"X1",Y1:"Y1",Z1:"Z1",X2:"X2",Y2:"Y2",Z2:"Z2"},offset:0}}}addEventListener("message",d=>{let{nodes:{data:n,keyMapping:i,offset:o},targetSelector:u,maxDistance:m,reportStep:s=Math.floor(n.length/20)}=d.data,C=new ae(n,i,o),{length:E}=C,F=[];postMessage(me(0,E));for(let G of Ae(C,u,m))F.push(G),F.length%s===0&&postMessage(me(F.length,E));postMessage(me(E,E)),postMessage($e(F))});
