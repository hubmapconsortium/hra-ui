var Me=Object.create;var ve=Object.defineProperty;var Pe=Object.getOwnPropertyDescriptor;var Te=Object.getOwnPropertyNames;var Re=Object.getPrototypeOf,Se=Object.prototype.hasOwnProperty;var Ie=(f,n)=>()=>(n||f((n={exports:{}}).exports,n),n.exports);var Oe=(f,n,s,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let l of Te(n))!Se.call(f,l)&&l!==s&&ve(f,l,{get:()=>n[l],enumerable:!(o=Pe(n,l))||o.enumerable});return f};var Ve=(f,n,s)=>(s=f!=null?Me(Re(f)):{},Oe(n||!f||!f.__esModule?ve(s,"default",{value:f,enumerable:!0}):s,f));var Ce=Ie((he,ye)=>{"use strict";(function(f,n){typeof ye=="object"&&typeof he<"u"?ye.exports=n():f.Papa=n()})(he,function f(){"use strict";var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},s=!n.document&&!!n.postMessage,o=n.IS_PAPA_WORKER||!1,l={},m=0,i={parse:function(t,e){var r=(e=e||{}).dynamicTyping||!1;if(k(r)&&(e.dynamicTypingFunction=r,r={}),e.dynamicTyping=r,e.transform=!!k(e.transform)&&e.transform,e.worker&&i.WORKERS_SUPPORTED){var a=function(){if(!i.WORKERS_SUPPORTED)return!1;var y=(K=n.URL||n.webkitURL||null,M=f.toString(),i.BLOB_URL||(i.BLOB_URL=K.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",M,")();"],{type:"text/javascript"})))),g=new n.Worker(y),K,M;return g.onmessage=De,g.id=m++,l[g.id]=g}();return a.userStep=e.step,a.userChunk=e.chunk,a.userComplete=e.complete,a.userError=e.error,e.step=k(e.step),e.chunk=k(e.chunk),e.complete=k(e.complete),e.error=k(e.error),delete e.worker,void a.postMessage({input:t,config:e,workerId:a.id})}var c=null;return i.NODE_STREAM_INPUT,typeof t=="string"?(t=function(y){return y.charCodeAt(0)===65279?y.slice(1):y}(t),c=e.download?new T(e):new Z(e)):t.readable===!0&&k(t.read)&&k(t.on)?c=new ue(e):(n.File&&t instanceof File||t instanceof Object)&&(c=new U(e)),c.stream(t)},unparse:function(t,e){var r=!1,a=!0,c=",",y=`\r
`,g='"',K=g+g,M=!1,d=null,R=!1;(function(){if(typeof e=="object"){if(typeof e.delimiter!="string"||i.BAD_DELIMITERS.filter(function(u){return e.delimiter.indexOf(u)!==-1}).length||(c=e.delimiter),(typeof e.quotes=="boolean"||typeof e.quotes=="function"||Array.isArray(e.quotes))&&(r=e.quotes),typeof e.skipEmptyLines!="boolean"&&typeof e.skipEmptyLines!="string"||(M=e.skipEmptyLines),typeof e.newline=="string"&&(y=e.newline),typeof e.quoteChar=="string"&&(g=e.quoteChar),typeof e.header=="boolean"&&(a=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");d=e.columns}e.escapeChar!==void 0&&(K=e.escapeChar+g),(typeof e.escapeFormulae=="boolean"||e.escapeFormulae instanceof RegExp)&&(R=e.escapeFormulae instanceof RegExp?e.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var h=new RegExp(oe(g),"g");if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return Y(null,t,M);if(typeof t[0]=="object")return Y(d||Object.keys(t[0]),t,M)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||d),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),Y(t.fields||[],t.data||[],M);throw new Error("Unable to serialize unrecognized input");function Y(u,x,z){var P="";typeof u=="string"&&(u=JSON.parse(u)),typeof x=="string"&&(x=JSON.parse(x));var N=Array.isArray(u)&&0<u.length,V=!Array.isArray(x[0]);if(N&&a){for(var F=0;F<u.length;F++)0<F&&(P+=c),P+=L(u[F],F);0<x.length&&(P+=y)}for(var p=0;p<x.length;p++){var _=N?u.length:x[p].length,A=!1,O=N?Object.keys(x[p]).length===0:x[p].length===0;if(z&&!N&&(A=z==="greedy"?x[p].join("").trim()==="":x[p].length===1&&x[p][0].length===0),z==="greedy"&&N){for(var w=[],W=0;W<_;W++){var S=V?u[W]:W;w.push(x[p][S])}A=w.join("").trim()===""}if(!A){for(var v=0;v<_;v++){0<v&&!O&&(P+=c);var $=N&&V?u[v]:v;P+=L(x[p][$],v)}p<x.length-1&&(!z||0<_&&!O)&&(P+=y)}}return P}function L(u,x){if(u==null)return"";if(u.constructor===Date)return JSON.stringify(u).slice(1,25);var z=!1;R&&typeof u=="string"&&R.test(u)&&(u="'"+u,z=!0);var P=u.toString().replace(h,K);return(z=z||r===!0||typeof r=="function"&&r(u,x)||Array.isArray(r)&&r[x]||function(N,V){for(var F=0;F<V.length;F++)if(-1<N.indexOf(V[F]))return!0;return!1}(P,i.BAD_DELIMITERS)||-1<P.indexOf(c)||P.charAt(0)===" "||P.charAt(P.length-1)===" ")?g+P+g:P}}};if(i.RECORD_SEP="",i.UNIT_SEP="",i.BYTE_ORDER_MARK="\uFEFF",i.BAD_DELIMITERS=["\r",`
`,'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!s&&!!n.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=ce,i.ParserHandle=_e,i.NetworkStreamer=T,i.FileStreamer=U,i.StringStreamer=Z,i.ReadableStreamStreamer=ue,n.jQuery){var C=n.jQuery;C.fn.parse=function(t){var e=t.config||{},r=[];return this.each(function(y){if(!(C(this).prop("tagName").toUpperCase()==="INPUT"&&C(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var g=0;g<this.files.length;g++)r.push({file:this.files[g],inputElem:this,instanceConfig:C.extend({},e)})}),a(),this;function a(){if(r.length!==0){var y,g,K,M,d=r[0];if(k(t.before)){var R=t.before(d.file,d.inputElem);if(typeof R=="object"){if(R.action==="abort")return y="AbortError",g=d.file,K=d.inputElem,M=R.reason,void(k(t.error)&&t.error({name:y},g,K,M));if(R.action==="skip")return void c();typeof R.config=="object"&&(d.instanceConfig=C.extend(d.instanceConfig,R.config))}else if(R==="skip")return void c()}var h=d.instanceConfig.complete;d.instanceConfig.complete=function(Y){k(h)&&h(Y,d.file,d.inputElem),c()},i.parse(d.file,d.instanceConfig)}else k(t.complete)&&t.complete()}function c(){r.splice(0,1),a()}}}function E(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(e){var r=de(e);r.chunkSize=parseInt(r.chunkSize),e.step||e.chunk||(r.chunkSize=null),this._handle=new _e(r),(this._handle.streamer=this)._config=r}).call(this,t),this.parseChunk=function(e,r){if(this.isFirstChunk&&k(this._config.beforeFirstChunk)){var a=this._config.beforeFirstChunk(e);a!==void 0&&(e=a)}this.isFirstChunk=!1,this._halted=!1;var c=this._partialLine+e;this._partialLine="";var y=this._handle.parse(c,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var g=y.meta.cursor;this._finished||(this._partialLine=c.substring(g-this._baseIndex),this._baseIndex=g),y&&y.data&&(this._rowCount+=y.data.length);var K=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(o)n.postMessage({results:y,workerId:i.WORKER_ID,finished:K});else if(k(this._config.chunk)&&!r){if(this._config.chunk(y,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);y=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(y.data),this._completeResults.errors=this._completeResults.errors.concat(y.errors),this._completeResults.meta=y.meta),this._completed||!K||!k(this._config.complete)||y&&y.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),K||y&&y.meta.paused||this._nextChunk(),y}this._halted=!0},this._sendError=function(e){k(this._config.error)?this._config.error(e):o&&this._config.error&&n.postMessage({workerId:i.WORKER_ID,error:e,finished:!1})}}function T(t){var e;(t=t||{}).chunkSize||(t.chunkSize=i.RemoteChunkSize),E.call(this,t),this._nextChunk=s?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(r){this._input=r,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(e=new XMLHttpRequest,this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),s||(e.onload=Q(this._chunkLoaded,this),e.onerror=Q(this._chunkError,this)),e.open(this._config.downloadRequestBody?"POST":"GET",this._input,!s),this._config.downloadRequestHeaders){var r=this._config.downloadRequestHeaders;for(var a in r)e.setRequestHeader(a,r[a])}if(this._config.chunkSize){var c=this._start+this._config.chunkSize-1;e.setRequestHeader("Range","bytes="+this._start+"-"+c)}try{e.send(this._config.downloadRequestBody)}catch(y){this._chunkError(y.message)}s&&e.status===0&&this._chunkError()}},this._chunkLoaded=function(){e.readyState===4&&(e.status<200||400<=e.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:e.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(r){var a=r.getResponseHeader("Content-Range");return a===null?-1:parseInt(a.substring(a.lastIndexOf("/")+1))}(e),this.parseChunk(e.responseText)))},this._chunkError=function(r){var a=e.statusText||r;this._sendError(new Error(a))}}function U(t){var e,r;(t=t||{}).chunkSize||(t.chunkSize=i.LocalChunkSize),E.call(this,t);var a=typeof FileReader<"u";this.stream=function(c){this._input=c,r=c.slice||c.webkitSlice||c.mozSlice,a?((e=new FileReader).onload=Q(this._chunkLoaded,this),e.onerror=Q(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var c=this._input;if(this._config.chunkSize){var y=Math.min(this._start+this._config.chunkSize,this._input.size);c=r.call(c,this._start,y)}var g=e.readAsText(c,this._config.encoding);a||this._chunkLoaded({target:{result:g}})},this._chunkLoaded=function(c){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(c.target.result)},this._chunkError=function(){this._sendError(e.error)}}function Z(t){var e;E.call(this,t=t||{}),this.stream=function(r){return e=r,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var r,a=this._config.chunkSize;return a?(r=e.substring(0,a),e=e.substring(a)):(r=e,e=""),this._finished=!e,this.parseChunk(r)}}}function ue(t){E.call(this,t=t||{});var e=[],r=!0,a=!1;this.pause=function(){E.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){E.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(c){this._input=c,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){a&&e.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),e.length?this.parseChunk(e.shift()):r=!0},this._streamData=Q(function(c){try{e.push(typeof c=="string"?c:c.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(e.shift()))}catch(y){this._streamError(y)}},this),this._streamError=Q(function(c){this._streamCleanUp(),this._sendError(c)},this),this._streamEnd=Q(function(){this._streamCleanUp(),a=!0,this._streamData("")},this),this._streamCleanUp=Q(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function _e(t){var e,r,a,c=Math.pow(2,53),y=-c,g=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,K=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,M=this,d=0,R=0,h=!1,Y=!1,L=[],u={data:[],errors:[],meta:{}};if(k(t.step)){var x=t.step;t.step=function(p){if(u=p,N())P();else{if(P(),u.data.length===0)return;d+=p.data.length,t.preview&&d>t.preview?r.abort():(u.data=u.data[0],x(u,M))}}}function z(p){return t.skipEmptyLines==="greedy"?p.join("").trim()==="":p.length===1&&p[0].length===0}function P(){return u&&a&&(F("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),a=!1),t.skipEmptyLines&&(u.data=u.data.filter(function(p){return!z(p)})),N()&&function(){if(!u)return;function p(A,O){k(t.transformHeader)&&(A=t.transformHeader(A,O)),L.push(A)}if(Array.isArray(u.data[0])){for(var _=0;N()&&_<u.data.length;_++)u.data[_].forEach(p);u.data.splice(0,1)}else u.data.forEach(p)}(),function(){if(!u||!t.header&&!t.dynamicTyping&&!t.transform)return u;function p(A,O){var w,W=t.header?{}:[];for(w=0;w<A.length;w++){var S=w,v=A[w];t.header&&(S=w>=L.length?"__parsed_extra":L[w]),t.transform&&(v=t.transform(v,S)),v=V(S,v),S==="__parsed_extra"?(W[S]=W[S]||[],W[S].push(v)):W[S]=v}return t.header&&(w>L.length?F("FieldMismatch","TooManyFields","Too many fields: expected "+L.length+" fields but parsed "+w,R+O):w<L.length&&F("FieldMismatch","TooFewFields","Too few fields: expected "+L.length+" fields but parsed "+w,R+O)),W}var _=1;return!u.data.length||Array.isArray(u.data[0])?(u.data=u.data.map(p),_=u.data.length):u.data=p(u.data,0),t.header&&u.meta&&(u.meta.fields=L),R+=_,u}()}function N(){return t.header&&L.length===0}function V(p,_){return A=p,t.dynamicTypingFunction&&t.dynamicTyping[A]===void 0&&(t.dynamicTyping[A]=t.dynamicTypingFunction(A)),(t.dynamicTyping[A]||t.dynamicTyping)===!0?_==="true"||_==="TRUE"||_!=="false"&&_!=="FALSE"&&(function(O){if(g.test(O)){var w=parseFloat(O);if(y<w&&w<c)return!0}return!1}(_)?parseFloat(_):K.test(_)?new Date(_):_===""?null:_):_;var A}function F(p,_,A,O){var w={type:p,code:_,message:A};O!==void 0&&(w.row=O),u.errors.push(w)}this.parse=function(p,_,A){var O=t.quoteChar||'"';if(t.newline||(t.newline=function(S,v){S=S.substring(0,1048576);var $=new RegExp(oe(v)+"([^]*?)"+oe(v),"gm"),j=(S=S.replace($,"")).split("\r"),X=S.split(`
`),G=1<X.length&&X[0].length<j[0].length;if(j.length===1||G)return`
`;for(var q=0,D=0;D<j.length;D++)j[D][0]===`
`&&q++;return q>=j.length/2?`\r
`:"\r"}(p,O)),a=!1,t.delimiter)k(t.delimiter)&&(t.delimiter=t.delimiter(p),u.meta.delimiter=t.delimiter);else{var w=function(S,v,$,j,X){var G,q,D,I;X=X||[",","	","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var ne=0;ne<X.length;ne++){var b=X[ne],se=0,J=0,ie=0;D=void 0;for(var ee=new ce({comments:j,delimiter:b,newline:v,preview:10}).parse(S),te=0;te<ee.data.length;te++)if($&&z(ee.data[te]))ie++;else{var re=ee.data[te].length;J+=re,D!==void 0?0<re&&(se+=Math.abs(re-D),D=re):D=re}0<ee.data.length&&(J/=ee.data.length-ie),(q===void 0||se<=q)&&(I===void 0||I<J)&&1.99<J&&(q=se,G=b,I=J)}return{successful:!!(t.delimiter=G),bestDelimiter:G}}(p,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess);w.successful?t.delimiter=w.bestDelimiter:(a=!0,t.delimiter=i.DefaultDelimiter),u.meta.delimiter=t.delimiter}var W=de(t);return t.preview&&t.header&&W.preview++,e=p,r=new ce(W),u=r.parse(e,_,A),P(),h?{meta:{paused:!0}}:u||{meta:{paused:!1}}},this.paused=function(){return h},this.pause=function(){h=!0,r.abort(),e=k(t.chunk)?"":e.substring(r.getCharIndex())},this.resume=function(){M.streamer._halted?(h=!1,M.streamer.parseChunk(e,!0)):setTimeout(M.resume,3)},this.aborted=function(){return Y},this.abort=function(){Y=!0,r.abort(),u.meta.aborted=!0,k(t.complete)&&t.complete(u),e=""}}function oe(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ce(t){var e,r=(t=t||{}).delimiter,a=t.newline,c=t.comments,y=t.step,g=t.preview,K=t.fastMode,M=e=t.quoteChar===void 0||t.quoteChar===null?'"':t.quoteChar;if(t.escapeChar!==void 0&&(M=t.escapeChar),(typeof r!="string"||-1<i.BAD_DELIMITERS.indexOf(r))&&(r=","),c===r)throw new Error("Comment character same as delimiter");c===!0?c="#":(typeof c!="string"||-1<i.BAD_DELIMITERS.indexOf(c))&&(c=!1),a!==`
`&&a!=="\r"&&a!==`\r
`&&(a=`
`);var d=0,R=!1;this.parse=function(h,Y,L){if(typeof h!="string")throw new Error("Input must be a string");var u=h.length,x=r.length,z=a.length,P=c.length,N=k(y),V=[],F=[],p=[],_=d=0;if(!h)return B();if(t.header&&!Y){var A=h.split(a)[0].split(r),O=[],w={},W=!1;for(var S in A){var v=A[S];k(t.transformHeader)&&(v=t.transformHeader(v,S));var $=v,j=w[v]||0;for(0<j&&(W=!0,$=v+"_"+j),w[v]=j+1;O.includes($);)$=$+"_"+j;O.push($)}if(W){var X=h.split(a);X[0]=O.join(r),h=X.join(a)}}if(K||K!==!1&&h.indexOf(e)===-1){for(var G=h.split(a),q=0;q<G.length;q++){if(p=G[q],d+=p.length,q!==G.length-1)d+=a.length;else if(L)return B();if(!c||p.substring(0,P)!==c){if(N){if(V=[],ie(p.split(r)),le(),R)return B()}else ie(p.split(r));if(g&&g<=q)return V=V.slice(0,g),B(!0)}}return B()}for(var D=h.indexOf(r,d),I=h.indexOf(a,d),ne=new RegExp(oe(M)+oe(e),"g"),b=h.indexOf(e,d);;)if(h[d]!==e)if(c&&p.length===0&&h.substring(d,d+P)===c){if(I===-1)return B();d=I+z,I=h.indexOf(a,d),D=h.indexOf(r,d)}else if(D!==-1&&(D<I||I===-1))p.push(h.substring(d,D)),d=D+x,D=h.indexOf(r,d);else{if(I===-1)break;if(p.push(h.substring(d,I)),re(I+z),N&&(le(),R))return B();if(g&&V.length>=g)return B(!0)}else for(b=d,d++;;){if((b=h.indexOf(e,b+1))===-1)return L||F.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:V.length,index:d}),te();if(b===u-1)return te(h.substring(d,b).replace(ne,e));if(e!==M||h[b+1]!==M){if(e===M||b===0||h[b-1]!==M){D!==-1&&D<b+1&&(D=h.indexOf(r,b+1)),I!==-1&&I<b+1&&(I=h.indexOf(a,b+1));var se=ee(I===-1?D:Math.min(D,I));if(h.substr(b+1+se,x)===r){p.push(h.substring(d,b).replace(ne,e)),h[d=b+1+se+x]!==e&&(b=h.indexOf(e,d)),D=h.indexOf(r,d),I=h.indexOf(a,d);break}var J=ee(I);if(h.substring(b+1+J,b+1+J+z)===a){if(p.push(h.substring(d,b).replace(ne,e)),re(b+1+J+z),D=h.indexOf(r,d),b=h.indexOf(e,d),N&&(le(),R))return B();if(g&&V.length>=g)return B(!0);break}F.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:V.length,index:d}),b++}}else b++}return te();function ie(H){V.push(H),_=d}function ee(H){var we=0;if(H!==-1){var pe=h.substring(b+1,H);pe&&pe.trim()===""&&(we=pe.length)}return we}function te(H){return L||(H===void 0&&(H=h.substring(d)),p.push(H),d=u,ie(p),N&&le()),B()}function re(H){d=H,ie(p),p=[],I=h.indexOf(a,d)}function B(H){return{data:V,errors:F,meta:{delimiter:r,linebreak:a,aborted:R,truncated:!!H,cursor:_+(Y||0)}}}function le(){y(B()),V=[],F=[]}},this.abort=function(){R=!0},this.getCharIndex=function(){return d}}function De(t){var e=t.data,r=l[e.workerId],a=!1;if(e.error)r.userError(e.error,e.file);else if(e.results&&e.results.data){var c={abort:function(){a=!0,be(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:ke,resume:ke};if(k(r.userStep)){for(var y=0;y<e.results.data.length&&(r.userStep({data:e.results.data[y],errors:e.results.errors,meta:e.results.meta},c),!a);y++);delete e.results}else k(r.userChunk)&&(r.userChunk(e.results,c,e.file),delete e.results)}e.finished&&!a&&be(e.workerId,e.results)}function be(t,e){var r=l[t];k(r.userComplete)&&r.userComplete(e),r.terminate(),delete l[t]}function ke(){throw new Error("Not implemented.")}function de(t){if(typeof t!="object"||t===null)return t;var e=Array.isArray(t)?[]:{};for(var r in t)e[r]=de(t[r]);return e}function Q(t,e){return function(){t.apply(e,arguments)}}function k(t){return typeof t=="function"}return o&&(n.onmessage=function(t){var e=t.data;if(i.WORKER_ID===void 0&&e&&(i.WORKER_ID=e.workerId),typeof e.input=="string")n.postMessage({workerId:i.WORKER_ID,results:i.parse(e.input,e.config),finished:!0});else if(n.File&&e.input instanceof File||e.input instanceof Object){var r=i.parse(e.input,e.config);r&&n.postMessage({workerId:i.WORKER_ID,results:r,finished:!0})}}),(T.prototype=Object.create(E.prototype)).constructor=T,(U.prototype=Object.create(E.prototype)).constructor=U,(Z.prototype=Object.create(Z.prototype)).constructor=Z,(ue.prototype=Object.create(E.prototype)).constructor=ue,i})});var me=Ve(Ce());function ge(f,n){let s=Symbol(),o=f;return()=>(o[s]??=n(),o[s])}function Fe(f,n){let s=String(f).replace(/\s+/g,"");return`get${s.slice(0,1).toUpperCase()+s.slice(1)}${n}`}function Ke(f,n,s){let o=f.keyMapping[n];if(o===void 0)return()=>{};if(s==="At"){let{data:l,offset:m}=f;return i=>(l[i+m]??{})[o]}else return l=>l[o]}function Ne(f,n){let s=["At","For"];for(let o of n)for(let l of s){let m=Fe(o,l),i=Ke(f,o,l);f[m]=i}}function*Le(f,n,s,o,l,m){o=Math.min(o,f.length);for(let i=s;i<o;i++){let C=f[i],E=[];if(m?.(C,i-l)!==!1){for(let T of n){let U=C[T],Z=typeof U!="object"?U:JSON.stringify(U);E.push(Z)}yield E}}}async function ze(f,n,s,o){let m=Object.values(n),i=[(0,me.unparse)([Object.keys(n)]),`\r
`];for(let C=s;C<f.length;C+=5e3){let E=Array.from(Le(f,m,C,C+5e3,s,o));i.push((0,me.unparse)(E),`\r
`),await new Promise(T=>setTimeout(T))}return i.pop(),new Blob(i)}function xe(f){class n{constructor(o,l,m=0){this.data=o;this.keyMapping=l;this.offset=m;this.keys=f;this.at=o=>this.data[this.offset+o];this.getPropertyAt=(o,l)=>this.getPropertyFor(this.data[this.offset+o]??{},l);this.getPropertyFor=(o,l)=>{let m=this.keyMapping[l];if(m!==void 0)return o[m]};this.length=o.length-m,Ne(this,this.keys)}[Symbol.iterator](){let o=this.data[Symbol.iterator]();for(let l=0;l<this.offset;l++)o.next();return o}toCsv(o){return ze(this.data,this.keyMapping,this.offset,o)}}return n}var Ge=Symbol("DataView offset");var We=["Cell Type","X","Y"],Ue=["Cell Ontology ID","Z"],je=xe([...We,...Ue]),ae=class extends je{constructor(){super(...arguments);this.getPositionAt=(s,o)=>this.getPositionFor(this.at(s),o);this.getPositionFor=(s,o)=>{let l=o?.target??new Array(3);return l[0]=this.getXFor(s),l[1]=this.getYFor(s),l[2]=this.getZFor(s)??0,l};this.getDimensions=ge(this,()=>{let s=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let l of this){let m=this.getXFor(l),i=this.getYFor(l),C=this.getZFor(l)??0;s=Math.min(s,m,i,C),o=Math.max(o,m,i,C)}return[s,o]});this.getCounts=ge(this,()=>{let s={};for(let o of this){let l=this.getCellTypeFor(o);s[l]??=0,s[l]+=1}return new Map(Object.entries(s))});this.createFilter=s=>(o,l)=>s.includes(this.getCellTypeFor(o),l)}},lt=new ae([],{"Cell Type":0,X:1,Y:2});var qe=[[-1,-1],[-1,0],[-1,1],[1,-1],[1,0],[1,1],[0,-1],[0,0],[0,1]],fe=class{constructor(){this.grid={}}addCellAt(n,s,o){this.ensureCellsExistsAt(n,s).push(o)}getCellsAt(n,s){return this.grid[n]?.[s]}*getNonEmptyIndices(){for(let n in this.grid)for(let s in this.grid[n])yield[+n,+s]}*getNeighborhood(n,s){for(let[o,l]of qe){let m=this.getCellsAt(n+o,s+l);m!==void 0&&(yield*m)}}ensureCellsExistsAt(n,s){return this.grid[n]??={},this.grid[n][s]??=[],this.grid[n][s]}};function Be(f,n,s){let o=new fe,l=new fe,m=0;for(let i of f){let C=f.getCellTypeFor(i),E={index:m,type:C,x:f.getXFor(i),y:f.getYFor(i),z:f.getZFor(i)??0,object:i},T=C===n?l:o,U=Math.floor(E.x/s),Z=Math.floor(E.y/s);T.addCellAt(U,Z,E),m++}return{sourceCells:o,targetCells:l}}function He(f,n){let s=f.x-n.x,o=f.y-n.y,l=f.z-n.z;return s*s+o*o+l*l}function Ye(f,n,s){let o=s*s,l;for(let m of n){let i=He(f,m);i<o&&(o=i,l=m)}return l}function*Ae(f,n,s){let{sourceCells:o,targetCells:l}=Be(f,n,s);for(let[m,i]of o.getNonEmptyIndices()){let C=Array.from(l.getNeighborhood(m,i));for(let E of o.getCellsAt(m,i)??[]){let T=Ye(E,C,s);T!==void 0&&(yield{"Cell ID":E.index,"Target ID":T.index,X1:E.x,Y1:E.y,Z1:E.z,X2:T.x,Y2:T.y,Z2:T.z})}}}var ct=new Intl.DateTimeFormat(void 0,{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3});function Ee(f,n){return{type:"progress",processed:f,total:n,timestamp:Date.now()}}function $e(f){return{type:"result",edges:{data:f,keyMapping:{"Cell ID":"Cell ID","Target ID":"Target ID",X1:"X1",Y1:"Y1",Z1:"Z1",X2:"X2",Y2:"Y2",Z2:"Z2"},offset:0}}}addEventListener("message",f=>{let{nodes:{data:n,keyMapping:s,offset:o},targetSelector:l,maxDistance:m,reportStep:i=Math.floor(n.length/20)}=f.data,C=new ae(n,s,o),{length:E}=C,T=[];postMessage(Ee(0,E));for(let U of Ae(C,l,m))T.push(U),T.length%i===0&&postMessage(Ee(T.length,E));postMessage(Ee(E,E)),postMessage($e(T))});
