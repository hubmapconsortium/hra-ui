var Me=Object.create;var we=Object.defineProperty;var Te=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames;var Pe=Object.getPrototypeOf,Re=Object.prototype.hasOwnProperty;var Oe=(d,n)=>()=>(n||d((n={exports:{}}).exports,n),n.exports);var Ie=(d,n,s,a)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of Se(n))!Re.call(d,i)&&i!==s&&we(d,i,{get:()=>n[i],enumerable:!(a=Te(n,i))||a.enumerable});return d};var Ve=(d,n,s)=>(s=d!=null?Me(Pe(d)):{},Ie(n||!d||!d.__esModule?we(s,"default",{value:d,enumerable:!0}):s,d));var ve=Oe((he,ye)=>{"use strict";(function(d,n){typeof ye=="object"&&typeof he<"u"?ye.exports=n():d.Papa=n()})(he,function d(){"use strict";var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},s=!n.document&&!!n.postMessage,a=n.IS_PAPA_WORKER||!1,i={},g=0,o={parse:function(t,e){var r=(e=e||{}).dynamicTyping||!1;if(k(r)&&(e.dynamicTypingFunction=r,r={}),e.dynamicTyping=r,e.transform=!!k(e.transform)&&e.transform,e.worker&&o.WORKERS_SUPPORTED){var u=function(){if(!o.WORKERS_SUPPORTED)return!1;var y=(K=n.URL||n.webkitURL||null,M=d.toString(),o.BLOB_URL||(o.BLOB_URL=K.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",M,")();"],{type:"text/javascript"})))),m=new n.Worker(y),K,M;return m.onmessage=De,m.id=g++,i[m.id]=m}();return u.userStep=e.step,u.userChunk=e.chunk,u.userComplete=e.complete,u.userError=e.error,e.step=k(e.step),e.chunk=k(e.chunk),e.complete=k(e.complete),e.error=k(e.error),delete e.worker,void u.postMessage({input:t,config:e,workerId:u.id})}var c=null;return o.NODE_STREAM_INPUT,typeof t=="string"?(t=function(y){return y.charCodeAt(0)===65279?y.slice(1):y}(t),c=e.download?new S(e):new re(e)):t.readable===!0&&k(t.read)&&k(t.on)?c=new ue(e):(n.File&&t instanceof File||t instanceof Object)&&(c=new Y(e)),c.stream(t)},unparse:function(t,e){var r=!1,u=!0,c=",",y=`\r
`,m='"',K=m+m,M=!1,f=null,P=!1;(function(){if(typeof e=="object"){if(typeof e.delimiter!="string"||o.BAD_DELIMITERS.filter(function(l){return e.delimiter.indexOf(l)!==-1}).length||(c=e.delimiter),(typeof e.quotes=="boolean"||typeof e.quotes=="function"||Array.isArray(e.quotes))&&(r=e.quotes),typeof e.skipEmptyLines!="boolean"&&typeof e.skipEmptyLines!="string"||(M=e.skipEmptyLines),typeof e.newline=="string"&&(y=e.newline),typeof e.quoteChar=="string"&&(m=e.quoteChar),typeof e.header=="boolean"&&(u=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");f=e.columns}e.escapeChar!==void 0&&(K=e.escapeChar+m),(typeof e.escapeFormulae=="boolean"||e.escapeFormulae instanceof RegExp)&&(P=e.escapeFormulae instanceof RegExp?e.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var h=new RegExp(oe(m),"g");if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return q(null,t,M);if(typeof t[0]=="object")return q(f||Object.keys(t[0]),t,M)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||f),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),q(t.fields||[],t.data||[],M);throw new Error("Unable to serialize unrecognized input");function q(l,A,z){var T="";typeof l=="string"&&(l=JSON.parse(l)),typeof A=="string"&&(A=JSON.parse(A));var N=Array.isArray(l)&&0<l.length,V=!Array.isArray(A[0]);if(N&&u){for(var F=0;F<l.length;F++)0<F&&(T+=c),T+=L(l[F],F);0<A.length&&(T+=y)}for(var p=0;p<A.length;p++){var b=N?l.length:A[p].length,C=!1,I=N?Object.keys(A[p]).length===0:A[p].length===0;if(z&&!N&&(C=z==="greedy"?A[p].join("").trim()==="":A[p].length===1&&A[p][0].length===0),z==="greedy"&&N){for(var w=[],U=0;U<b;U++){var R=V?l[U]:U;w.push(A[p][R])}C=w.join("").trim()===""}if(!C){for(var x=0;x<b;x++){0<x&&!I&&(T+=c);var $=N&&V?l[x]:x;T+=L(A[p][$],x)}p<A.length-1&&(!z||0<b&&!I)&&(T+=y)}}return T}function L(l,A){if(l==null)return"";if(l.constructor===Date)return JSON.stringify(l).slice(1,25);var z=!1;P&&typeof l=="string"&&P.test(l)&&(l="'"+l,z=!0);var T=l.toString().replace(h,K);return(z=z||r===!0||typeof r=="function"&&r(l,A)||Array.isArray(r)&&r[A]||function(N,V){for(var F=0;F<V.length;F++)if(-1<N.indexOf(V[F]))return!0;return!1}(T,o.BAD_DELIMITERS)||-1<T.indexOf(c)||T.charAt(0)===" "||T.charAt(T.length-1)===" ")?m+T+m:T}}};if(o.RECORD_SEP="",o.UNIT_SEP="",o.BYTE_ORDER_MARK="\uFEFF",o.BAD_DELIMITERS=["\r",`
`,'"',o.BYTE_ORDER_MARK],o.WORKERS_SUPPORTED=!s&&!!n.Worker,o.NODE_STREAM_INPUT=1,o.LocalChunkSize=10485760,o.RemoteChunkSize=5242880,o.DefaultDelimiter=",",o.Parser=fe,o.ParserHandle=Ee,o.NetworkStreamer=S,o.FileStreamer=Y,o.StringStreamer=re,o.ReadableStreamStreamer=ue,n.jQuery){var v=n.jQuery;v.fn.parse=function(t){var e=t.config||{},r=[];return this.each(function(y){if(!(v(this).prop("tagName").toUpperCase()==="INPUT"&&v(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var m=0;m<this.files.length;m++)r.push({file:this.files[m],inputElem:this,instanceConfig:v.extend({},e)})}),u(),this;function u(){if(r.length!==0){var y,m,K,M,f=r[0];if(k(t.before)){var P=t.before(f.file,f.inputElem);if(typeof P=="object"){if(P.action==="abort")return y="AbortError",m=f.file,K=f.inputElem,M=P.reason,void(k(t.error)&&t.error({name:y},m,K,M));if(P.action==="skip")return void c();typeof P.config=="object"&&(f.instanceConfig=v.extend(f.instanceConfig,P.config))}else if(P==="skip")return void c()}var h=f.instanceConfig.complete;f.instanceConfig.complete=function(q){k(h)&&h(q,f.file,f.inputElem),c()},o.parse(f.file,f.instanceConfig)}else k(t.complete)&&t.complete()}function c(){r.splice(0,1),u()}}}function E(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(e){var r=de(e);r.chunkSize=parseInt(r.chunkSize),e.step||e.chunk||(r.chunkSize=null),this._handle=new Ee(r),(this._handle.streamer=this)._config=r}).call(this,t),this.parseChunk=function(e,r){if(this.isFirstChunk&&k(this._config.beforeFirstChunk)){var u=this._config.beforeFirstChunk(e);u!==void 0&&(e=u)}this.isFirstChunk=!1,this._halted=!1;var c=this._partialLine+e;this._partialLine="";var y=this._handle.parse(c,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var m=y.meta.cursor;this._finished||(this._partialLine=c.substring(m-this._baseIndex),this._baseIndex=m),y&&y.data&&(this._rowCount+=y.data.length);var K=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(a)n.postMessage({results:y,workerId:o.WORKER_ID,finished:K});else if(k(this._config.chunk)&&!r){if(this._config.chunk(y,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);y=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(y.data),this._completeResults.errors=this._completeResults.errors.concat(y.errors),this._completeResults.meta=y.meta),this._completed||!K||!k(this._config.complete)||y&&y.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),K||y&&y.meta.paused||this._nextChunk(),y}this._halted=!0},this._sendError=function(e){k(this._config.error)?this._config.error(e):a&&this._config.error&&n.postMessage({workerId:o.WORKER_ID,error:e,finished:!1})}}function S(t){var e;(t=t||{}).chunkSize||(t.chunkSize=o.RemoteChunkSize),E.call(this,t),this._nextChunk=s?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(r){this._input=r,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(e=new XMLHttpRequest,this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),s||(e.onload=J(this._chunkLoaded,this),e.onerror=J(this._chunkError,this)),e.open(this._config.downloadRequestBody?"POST":"GET",this._input,!s),this._config.downloadRequestHeaders){var r=this._config.downloadRequestHeaders;for(var u in r)e.setRequestHeader(u,r[u])}if(this._config.chunkSize){var c=this._start+this._config.chunkSize-1;e.setRequestHeader("Range","bytes="+this._start+"-"+c)}try{e.send(this._config.downloadRequestBody)}catch(y){this._chunkError(y.message)}s&&e.status===0&&this._chunkError()}},this._chunkLoaded=function(){e.readyState===4&&(e.status<200||400<=e.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:e.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(r){var u=r.getResponseHeader("Content-Range");return u===null?-1:parseInt(u.substring(u.lastIndexOf("/")+1))}(e),this.parseChunk(e.responseText)))},this._chunkError=function(r){var u=e.statusText||r;this._sendError(new Error(u))}}function Y(t){var e,r;(t=t||{}).chunkSize||(t.chunkSize=o.LocalChunkSize),E.call(this,t);var u=typeof FileReader<"u";this.stream=function(c){this._input=c,r=c.slice||c.webkitSlice||c.mozSlice,u?((e=new FileReader).onload=J(this._chunkLoaded,this),e.onerror=J(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var c=this._input;if(this._config.chunkSize){var y=Math.min(this._start+this._config.chunkSize,this._input.size);c=r.call(c,this._start,y)}var m=e.readAsText(c,this._config.encoding);u||this._chunkLoaded({target:{result:m}})},this._chunkLoaded=function(c){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(c.target.result)},this._chunkError=function(){this._sendError(e.error)}}function re(t){var e;E.call(this,t=t||{}),this.stream=function(r){return e=r,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var r,u=this._config.chunkSize;return u?(r=e.substring(0,u),e=e.substring(u)):(r=e,e=""),this._finished=!e,this.parseChunk(r)}}}function ue(t){E.call(this,t=t||{});var e=[],r=!0,u=!1;this.pause=function(){E.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){E.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(c){this._input=c,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){u&&e.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),e.length?this.parseChunk(e.shift()):r=!0},this._streamData=J(function(c){try{e.push(typeof c=="string"?c:c.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(e.shift()))}catch(y){this._streamError(y)}},this),this._streamError=J(function(c){this._streamCleanUp(),this._sendError(c)},this),this._streamEnd=J(function(){this._streamCleanUp(),u=!0,this._streamData("")},this),this._streamCleanUp=J(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function Ee(t){var e,r,u,c=Math.pow(2,53),y=-c,m=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,K=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,M=this,f=0,P=0,h=!1,q=!1,L=[],l={data:[],errors:[],meta:{}};if(k(t.step)){var A=t.step;t.step=function(p){if(l=p,N())T();else{if(T(),l.data.length===0)return;f+=p.data.length,t.preview&&f>t.preview?r.abort():(l.data=l.data[0],A(l,M))}}}function z(p){return t.skipEmptyLines==="greedy"?p.join("").trim()==="":p.length===1&&p[0].length===0}function T(){return l&&u&&(F("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+o.DefaultDelimiter+"'"),u=!1),t.skipEmptyLines&&(l.data=l.data.filter(function(p){return!z(p)})),N()&&function(){if(!l)return;function p(C,I){k(t.transformHeader)&&(C=t.transformHeader(C,I)),L.push(C)}if(Array.isArray(l.data[0])){for(var b=0;N()&&b<l.data.length;b++)l.data[b].forEach(p);l.data.splice(0,1)}else l.data.forEach(p)}(),function(){if(!l||!t.header&&!t.dynamicTyping&&!t.transform)return l;function p(C,I){var w,U=t.header?{}:[];for(w=0;w<C.length;w++){var R=w,x=C[w];t.header&&(R=w>=L.length?"__parsed_extra":L[w]),t.transform&&(x=t.transform(x,R)),x=V(R,x),R==="__parsed_extra"?(U[R]=U[R]||[],U[R].push(x)):U[R]=x}return t.header&&(w>L.length?F("FieldMismatch","TooManyFields","Too many fields: expected "+L.length+" fields but parsed "+w,P+I):w<L.length&&F("FieldMismatch","TooFewFields","Too few fields: expected "+L.length+" fields but parsed "+w,P+I)),U}var b=1;return!l.data.length||Array.isArray(l.data[0])?(l.data=l.data.map(p),b=l.data.length):l.data=p(l.data,0),t.header&&l.meta&&(l.meta.fields=L),P+=b,l}()}function N(){return t.header&&L.length===0}function V(p,b){return C=p,t.dynamicTypingFunction&&t.dynamicTyping[C]===void 0&&(t.dynamicTyping[C]=t.dynamicTypingFunction(C)),(t.dynamicTyping[C]||t.dynamicTyping)===!0?b==="true"||b==="TRUE"||b!=="false"&&b!=="FALSE"&&(function(I){if(m.test(I)){var w=parseFloat(I);if(y<w&&w<c)return!0}return!1}(b)?parseFloat(b):K.test(b)?new Date(b):b===""?null:b):b;var C}function F(p,b,C,I){var w={type:p,code:b,message:C};I!==void 0&&(w.row=I),l.errors.push(w)}this.parse=function(p,b,C){var I=t.quoteChar||'"';if(t.newline||(t.newline=function(R,x){R=R.substring(0,1048576);var $=new RegExp(oe(x)+"([^]*?)"+oe(x),"gm"),W=(R=R.replace($,"")).split("\r"),Z=R.split(`
`),X=1<Z.length&&Z[0].length<W[0].length;if(W.length===1||X)return`
`;for(var j=0,D=0;D<W.length;D++)W[D][0]===`
`&&j++;return j>=W.length/2?`\r
`:"\r"}(p,I)),u=!1,t.delimiter)k(t.delimiter)&&(t.delimiter=t.delimiter(p),l.meta.delimiter=t.delimiter);else{var w=function(R,x,$,W,Z){var X,j,D,O;Z=Z||[",","	","|",";",o.RECORD_SEP,o.UNIT_SEP];for(var ne=0;ne<Z.length;ne++){var _=Z[ne],se=0,G=0,ie=0;D=void 0;for(var Q=new fe({comments:W,delimiter:_,newline:x,preview:10}).parse(R),ee=0;ee<Q.data.length;ee++)if($&&z(Q.data[ee]))ie++;else{var te=Q.data[ee].length;G+=te,D!==void 0?0<te&&(se+=Math.abs(te-D),D=te):D=te}0<Q.data.length&&(G/=Q.data.length-ie),(j===void 0||se<=j)&&(O===void 0||O<G)&&1.99<G&&(j=se,X=_,O=G)}return{successful:!!(t.delimiter=X),bestDelimiter:X}}(p,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess);w.successful?t.delimiter=w.bestDelimiter:(u=!0,t.delimiter=o.DefaultDelimiter),l.meta.delimiter=t.delimiter}var U=de(t);return t.preview&&t.header&&U.preview++,e=p,r=new fe(U),l=r.parse(e,b,C),T(),h?{meta:{paused:!0}}:l||{meta:{paused:!1}}},this.paused=function(){return h},this.pause=function(){h=!0,r.abort(),e=k(t.chunk)?"":e.substring(r.getCharIndex())},this.resume=function(){M.streamer._halted?(h=!1,M.streamer.parseChunk(e,!0)):setTimeout(M.resume,3)},this.aborted=function(){return q},this.abort=function(){q=!0,r.abort(),l.meta.aborted=!0,k(t.complete)&&t.complete(l),e=""}}function oe(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function fe(t){var e,r=(t=t||{}).delimiter,u=t.newline,c=t.comments,y=t.step,m=t.preview,K=t.fastMode,M=e=t.quoteChar===void 0||t.quoteChar===null?'"':t.quoteChar;if(t.escapeChar!==void 0&&(M=t.escapeChar),(typeof r!="string"||-1<o.BAD_DELIMITERS.indexOf(r))&&(r=","),c===r)throw new Error("Comment character same as delimiter");c===!0?c="#":(typeof c!="string"||-1<o.BAD_DELIMITERS.indexOf(c))&&(c=!1),u!==`
`&&u!=="\r"&&u!==`\r
`&&(u=`
`);var f=0,P=!1;this.parse=function(h,q,L){if(typeof h!="string")throw new Error("Input must be a string");var l=h.length,A=r.length,z=u.length,T=c.length,N=k(y),V=[],F=[],p=[],b=f=0;if(!h)return H();if(t.header&&!q){var C=h.split(u)[0].split(r),I=[],w={},U=!1;for(var R in C){var x=C[R];k(t.transformHeader)&&(x=t.transformHeader(x,R));var $=x,W=w[x]||0;for(0<W&&(U=!0,$=x+"_"+W),w[x]=W+1;I.includes($);)$=$+"_"+W;I.push($)}if(U){var Z=h.split(u);Z[0]=I.join(r),h=Z.join(u)}}if(K||K!==!1&&h.indexOf(e)===-1){for(var X=h.split(u),j=0;j<X.length;j++){if(p=X[j],f+=p.length,j!==X.length-1)f+=u.length;else if(L)return H();if(!c||p.substring(0,T)!==c){if(N){if(V=[],ie(p.split(r)),le(),P)return H()}else ie(p.split(r));if(m&&m<=j)return V=V.slice(0,m),H(!0)}}return H()}for(var D=h.indexOf(r,f),O=h.indexOf(u,f),ne=new RegExp(oe(M)+oe(e),"g"),_=h.indexOf(e,f);;)if(h[f]!==e)if(c&&p.length===0&&h.substring(f,f+T)===c){if(O===-1)return H();f=O+z,O=h.indexOf(u,f),D=h.indexOf(r,f)}else if(D!==-1&&(D<O||O===-1))p.push(h.substring(f,D)),f=D+A,D=h.indexOf(r,f);else{if(O===-1)break;if(p.push(h.substring(f,O)),te(O+z),N&&(le(),P))return H();if(m&&V.length>=m)return H(!0)}else for(_=f,f++;;){if((_=h.indexOf(e,_+1))===-1)return L||F.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:V.length,index:f}),ee();if(_===l-1)return ee(h.substring(f,_).replace(ne,e));if(e!==M||h[_+1]!==M){if(e===M||_===0||h[_-1]!==M){D!==-1&&D<_+1&&(D=h.indexOf(r,_+1)),O!==-1&&O<_+1&&(O=h.indexOf(u,_+1));var se=Q(O===-1?D:Math.min(D,O));if(h.substr(_+1+se,A)===r){p.push(h.substring(f,_).replace(ne,e)),h[f=_+1+se+A]!==e&&(_=h.indexOf(e,f)),D=h.indexOf(r,f),O=h.indexOf(u,f);break}var G=Q(O);if(h.substring(_+1+G,_+1+G+z)===u){if(p.push(h.substring(f,_).replace(ne,e)),te(_+1+G+z),D=h.indexOf(r,f),_=h.indexOf(e,f),N&&(le(),P))return H();if(m&&V.length>=m)return H(!0);break}F.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:V.length,index:f}),_++}}else _++}return ee();function ie(B){V.push(B),b=f}function Q(B){var ke=0;if(B!==-1){var pe=h.substring(_+1,B);pe&&pe.trim()===""&&(ke=pe.length)}return ke}function ee(B){return L||(B===void 0&&(B=h.substring(f)),p.push(B),f=l,ie(p),N&&le()),H()}function te(B){f=B,ie(p),p=[],O=h.indexOf(u,f)}function H(B){return{data:V,errors:F,meta:{delimiter:r,linebreak:u,aborted:P,truncated:!!B,cursor:b+(q||0)}}}function le(){y(H()),V=[],F=[]}},this.abort=function(){P=!0},this.getCharIndex=function(){return f}}function De(t){var e=t.data,r=i[e.workerId],u=!1;if(e.error)r.userError(e.error,e.file);else if(e.results&&e.results.data){var c={abort:function(){u=!0,be(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:_e,resume:_e};if(k(r.userStep)){for(var y=0;y<e.results.data.length&&(r.userStep({data:e.results.data[y],errors:e.results.errors,meta:e.results.meta},c),!u);y++);delete e.results}else k(r.userChunk)&&(r.userChunk(e.results,c,e.file),delete e.results)}e.finished&&!u&&be(e.workerId,e.results)}function be(t,e){var r=i[t];k(r.userComplete)&&r.userComplete(e),r.terminate(),delete i[t]}function _e(){throw new Error("Not implemented.")}function de(t){if(typeof t!="object"||t===null)return t;var e=Array.isArray(t)?[]:{};for(var r in t)e[r]=de(t[r]);return e}function J(t,e){return function(){t.apply(e,arguments)}}function k(t){return typeof t=="function"}return a&&(n.onmessage=function(t){var e=t.data;if(o.WORKER_ID===void 0&&e&&(o.WORKER_ID=e.workerId),typeof e.input=="string")n.postMessage({workerId:o.WORKER_ID,results:o.parse(e.input,e.config),finished:!0});else if(n.File&&e.input instanceof File||e.input instanceof Object){var r=o.parse(e.input,e.config);r&&n.postMessage({workerId:o.WORKER_ID,results:r,finished:!0})}}),(S.prototype=Object.create(E.prototype)).constructor=S,(Y.prototype=Object.create(E.prototype)).constructor=Y,(re.prototype=Object.create(re.prototype)).constructor=re,(ue.prototype=Object.create(E.prototype)).constructor=ue,o})});var Fe=Ve(ve());function ge(d,n){let s=Symbol(),a=d;return()=>(a[s]??=n(),a[s])}async function xe(d,n,s,a){let i=d[Symbol.iterator](),g=0,o=!1;for(;!o;){for(let v=0;v<n;v++,g++){let E=i.next();if(E.done){o=!0;break}s(E.value,g)}a?.(),await new Promise(v=>setTimeout(v,0))}}var Ke=Symbol("DataView header"),Je=Symbol("DataView data offset");function Ne(d,n){let s=String(d).replace(/\s+/g,"");return`get${s.slice(0,1).toUpperCase()+s.slice(1)}${n}`}function Le(d,n,s){let a=d.keyMapping[n];if(a===void 0)return()=>{};if(s==="At"){let{data:i,offset:g}=d;return o=>(i[o+g]??{})[a]}else return i=>i[a]}function ze(d,n){let s=["At","For"];for(let a of n)for(let i of s){let g=Ne(a,i),o=Le(d,a,i);d[g]=o}}function Ue(d,...n){let[s]=n.filter(i=>i!==void 0),a=s[Ke];return a===void 0?Object.entries(s):Array.isArray(d.at(0))?a.map((i,g)=>[i,g]):a.map(i=>[i,i])}function Ae(d){class n{constructor(a,i,g=0){this.data=a;this.keyMapping=i;this.offset=g;this.keys=d;this.at=a=>this.data[this.offset+a];this.getPropertyAt=(a,i)=>this.getPropertyFor(this.data[this.offset+a]??{},i);this.getPropertyFor=(a,i)=>{let g=this.keyMapping[i];if(g!==void 0)return a[g]};this.materializeAt=(a,i)=>this.materializeFor(this.at(a),i);this.materializeFor=(a,i)=>{let g=Ue(this,i,this.keyMapping),o={};for(let[v,E]of g){let S=a[E],Y=typeof S=="object"?JSON.stringify(S):S;o[v]=Y}return o};this.length=a.length-g,ze(this,this.keys)}[Symbol.iterator](){let a=this.data[Symbol.iterator]();for(let i=0;i<this.offset;i++)a.next();return a}}return n}var We=["Cell Type","X","Y"],je=["Cell Ontology ID","Z"],He=Ae([...We,...je]),ae=class extends He{constructor(){super(...arguments);this.getPositionAt=(s,a)=>this.getPositionFor(this.at(s),a);this.getPositionFor=(s,a)=>{let i=a?.target??new Array(3);return i[0]=this.getXFor(s),i[1]=this.getYFor(s),i[2]=this.getZFor(s)??0,i};this.getDimensions=ge(this,()=>{let s=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let i of this){let g=this.getXFor(i),o=this.getYFor(i),v=this.getZFor(i)??0;s=Math.min(s,g,o,v),a=Math.max(a,g,o,v)}return[s,a]});this.getCounts=ge(this,()=>{let s={};for(let a of this){let i=this.getCellTypeFor(a);s[i]??=0,s[i]+=1}return new Map(Object.entries(s))});this.createFilter=s=>(a,i)=>s.includes(this.getCellTypeFor(a),i);this.createReindexer=async s=>{let i=[],g=-1;return await xe(this,2e4,(o,v)=>{let E=s.includes(this.getCellTypeFor(o),v);g+=Number(E),i.push(g)}),i}}},ct=new ae([],{"Cell Type":0,X:1,Y:2});var Be=[[-1,-1],[-1,0],[-1,1],[1,-1],[1,0],[1,1],[0,-1],[0,0],[0,1]],ce=class{constructor(){this.grid={}}addCellAt(n,s,a){this.ensureCellsExistsAt(n,s).push(a)}getCellsAt(n,s){return this.grid[n]?.[s]}*getNonEmptyIndices(){for(let n in this.grid)for(let s in this.grid[n])yield[+n,+s]}*getNeighborhood(n,s){for(let[a,i]of Be){let g=this.getCellsAt(n+a,s+i);g!==void 0&&(yield*g)}}ensureCellsExistsAt(n,s){return this.grid[n]??={},this.grid[n][s]??=[],this.grid[n][s]}};function qe(d,n,s){let a=new ce,i=new ce,g=0;for(let o of d){let v=d.getCellTypeFor(o),E={index:g,type:v,x:d.getXFor(o),y:d.getYFor(o),z:d.getZFor(o)??0,object:o},S=v===n?i:a,Y=Math.floor(E.x/s),re=Math.floor(E.y/s);S.addCellAt(Y,re,E),g++}return{sourceCells:a,targetCells:i}}function $e(d,n){let s=d.x-n.x,a=d.y-n.y,i=d.z-n.z;return s*s+a*a+i*i}function Ye(d,n,s){let a=s*s,i;for(let g of n){let o=$e(d,g);o<a&&(a=o,i=g)}return i}function*Ce(d,n,s){let{sourceCells:a,targetCells:i}=qe(d,n,s);if(Object.keys(i).length===0){console.warn(`No target cells found using selector '${n}'`);return}for(let[g,o]of a.getNonEmptyIndices()){let v=Array.from(i.getNeighborhood(g,o));for(let E of a.getCellsAt(g,o)??[]){let S=Ye(E,v,s);S!==void 0&&(yield{"Cell ID":E.index,"Target ID":S.index,X1:E.x,Y1:E.y,Z1:E.z,X2:S.x,Y2:S.y,Z2:S.z})}}}var dt=new Intl.DateTimeFormat(void 0,{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3});function me(d,n){return{type:"progress",processed:d,total:n,timestamp:Date.now()}}function Ze(d){return{type:"result",edges:{data:d,keyMapping:{"Cell ID":"Cell ID","Target ID":"Target ID",X1:"X1",Y1:"Y1",Z1:"Z1",X2:"X2",Y2:"Y2",Z2:"Z2"},offset:0}}}addEventListener("message",d=>{let{nodes:{data:n,keyMapping:s,offset:a},targetSelector:i,maxDistance:g,reportStep:o=Math.floor(n.length/20)}=d.data,v=new ae(n,s,a),{length:E}=v,S=[];postMessage(me(0,E));for(let Y of Ce(v,i,g))S.push(Y),S.length%o===0&&postMessage(me(S.length,E));postMessage(me(E,E)),postMessage(Ze(S))});
