var De=Object.create;var be=Object.defineProperty;var ve=Object.getOwnPropertyDescriptor;var Ce=Object.getOwnPropertyNames;var Se=Object.getPrototypeOf,Me=Object.prototype.hasOwnProperty;var Re=(d,r)=>()=>(r||d((r={exports:{}}).exports,r),r.exports);var Te=(d,r,s,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of Ce(r))!Me.call(d,o)&&o!==s&&be(d,o,{get:()=>r[o],enumerable:!(i=ve(r,o))||i.enumerable});return d};var Pe=(d,r,s)=>(s=d!=null?De(Se(d)):{},Te(r||!d||!d.__esModule?be(s,"default",{value:d,enumerable:!0}):s,d));var _e=Re((de,ce)=>{"use strict";((d,r)=>{typeof ce=="object"&&typeof de<"u"?ce.exports=r():d.Papa=r()})(de,function d(){var r=typeof self<"u"?self:typeof window<"u"?window:r!==void 0?r:{},s,i=!r.document&&!!r.postMessage,o=r.IS_PAPA_WORKER||!1,y={},x=0,a={};function w(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(t){var n=le(t);n.chunkSize=parseInt(n.chunkSize),t.step||t.chunk||(n.chunkSize=null),this._handle=new he(n),(this._handle.streamer=this)._config=n}.call(this,e),this.parseChunk=function(t,n){var l=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<l){let g=this._config.newline;g||(u=this._config.quoteChar||'"',g=this._handle.guessLineEndings(t,u)),t=[...t.split(g).slice(l)].join(g)}this.isFirstChunk&&D(this._config.beforeFirstChunk)&&(u=this._config.beforeFirstChunk(t))!==void 0&&(t=u),this.isFirstChunk=!1,this._halted=!1;var l=this._partialLine+t,u=(this._partialLine="",this._handle.parse(l,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=u.meta.cursor,l=(this._finished||(this._partialLine=l.substring(t-this._baseIndex),this._baseIndex=t),u&&u.data&&(this._rowCount+=u.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),o)r.postMessage({results:u,workerId:a.WORKER_ID,finished:l});else if(D(this._config.chunk)&&!n){if(this._config.chunk(u,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=u=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(u.data),this._completeResults.errors=this._completeResults.errors.concat(u.errors),this._completeResults.meta=u.meta),this._completed||!l||!D(this._config.complete)||u&&u.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),l||u&&u.meta.paused||this._nextChunk(),u}this._halted=!0},this._sendError=function(t){D(this._config.error)?this._config.error(t):o&&this._config.error&&r.postMessage({workerId:a.WORKER_ID,error:t,finished:!1})}}function P(e){var t;(e=e||{}).chunkSize||(e.chunkSize=a.RemoteChunkSize),w.call(this,e),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(n){this._input=n,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),i||(t.onload=X(this._chunkLoaded,this),t.onerror=X(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var n,l=this._config.downloadRequestHeaders;for(n in l)t.setRequestHeader(n,l[n])}var u;this._config.chunkSize&&(u=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+u));try{t.send(this._config.downloadRequestBody)}catch(g){this._chunkError(g.message)}i&&t.status===0&&this._chunkError()}},this._chunkLoaded=function(){t.readyState===4&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(n=>(n=n.getResponseHeader("Content-Range"))!==null?parseInt(n.substring(n.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(n){n=t.statusText||n,this._sendError(new Error(n))}}function q(e){(e=e||{}).chunkSize||(e.chunkSize=a.LocalChunkSize),w.call(this,e);var t,n,l=typeof FileReader<"u";this.stream=function(u){this._input=u,n=u.slice||u.webkitSlice||u.mozSlice,l?((t=new FileReader).onload=X(this._chunkLoaded,this),t.onerror=X(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var u=this._input,g=(this._config.chunkSize&&(g=Math.min(this._start+this._config.chunkSize,this._input.size),u=n.call(u,this._start,g)),t.readAsText(u,this._config.encoding));l||this._chunkLoaded({target:{result:g}})},this._chunkLoaded=function(u){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(u.target.result)},this._chunkError=function(){this._sendError(t.error)}}function ee(e){var t;w.call(this,e=e||{}),this.stream=function(n){return t=n,this._nextChunk()},this._nextChunk=function(){var n,l;if(!this._finished)return n=this._config.chunkSize,t=n?(l=t.substring(0,n),t.substring(n)):(l=t,""),this._finished=!t,this.parseChunk(l)}}function oe(e){w.call(this,e=e||{});var t=[],n=!0,l=!1;this.pause=function(){w.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){w.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(u){this._input=u,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){l&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=X(function(u){try{t.push(typeof u=="string"?u:u.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(g){this._streamError(g)}},this),this._streamError=X(function(u){this._streamCleanUp(),this._sendError(u)},this),this._streamEnd=X(function(){this._streamCleanUp(),l=!0,this._streamData("")},this),this._streamCleanUp=X(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function he(e){var t,n,l,u,g=Math.pow(2,53),K=-g,W=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,S=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,A=this,f=0,j=0,p=!1,G=!1,E=[],c={data:[],errors:[],meta:{}};function V(h){return e.skipEmptyLines==="greedy"?h.join("").trim()==="":h.length===1&&h[0].length===0}function I(){if(c&&l&&(U("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),l=!1),e.skipEmptyLines&&(c.data=c.data.filter(function(C){return!V(C)})),L()){let C=function(F,_){D(e.transformHeader)&&(F=e.transformHeader(F,_)),E.push(F)};var v=C;if(c)if(Array.isArray(c.data[0])){for(var h=0;L()&&h<c.data.length;h++)c.data[h].forEach(C);c.data.splice(0,1)}else c.data.forEach(C)}function R(C,F){for(var _=e.header?{}:[],k=0;k<C.length;k++){var M=k,m=C[k],m=((H,T)=>(N=>(e.dynamicTypingFunction&&e.dynamicTyping[N]===void 0&&(e.dynamicTyping[N]=e.dynamicTypingFunction(N)),(e.dynamicTyping[N]||e.dynamicTyping)===!0))(H)?T==="true"||T==="TRUE"||T!=="false"&&T!=="FALSE"&&((N=>{if(W.test(N)&&(N=parseFloat(N),K<N&&N<g))return 1})(T)?parseFloat(T):S.test(T)?new Date(T):T===""?null:T):T)(M=e.header?k>=E.length?"__parsed_extra":E[k]:M,m=e.transform?e.transform(m,M):m);M==="__parsed_extra"?(_[M]=_[M]||[],_[M].push(m)):_[M]=m}return e.header&&(k>E.length?U("FieldMismatch","TooManyFields","Too many fields: expected "+E.length+" fields but parsed "+k,j+F):k<E.length&&U("FieldMismatch","TooFewFields","Too few fields: expected "+E.length+" fields but parsed "+k,j+F)),_}var b;c&&(e.header||e.dynamicTyping||e.transform)&&(b=1,!c.data.length||Array.isArray(c.data[0])?(c.data=c.data.map(R),b=c.data.length):c.data=R(c.data,0),e.header&&c.meta&&(c.meta.fields=E),j+=b)}function L(){return e.header&&E.length===0}function U(h,R,b,v){h={type:h,code:R,message:b},v!==void 0&&(h.row=v),c.errors.push(h)}D(e.step)&&(u=e.step,e.step=function(h){c=h,L()?I():(I(),c.data.length!==0&&(f+=h.data.length,e.preview&&f>e.preview?n.abort():(c.data=c.data[0],u(c,A))))}),this.parse=function(h,R,b){var v=e.quoteChar||'"',v=(e.newline||(e.newline=this.guessLineEndings(h,v)),l=!1,e.delimiter?D(e.delimiter)&&(e.delimiter=e.delimiter(h),c.meta.delimiter=e.delimiter):((v=((C,F,_,k,M)=>{var m,H,T,N;M=M||[",","	","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var te=0;te<M.length;te++){for(var Z,z=M[te],J=0,O=0,B=0,$=(T=void 0,new ue({comments:k,delimiter:z,newline:F,preview:10}).parse(C)),Q=0;Q<$.data.length;Q++)_&&V($.data[Q])?B++:(Z=$.data[Q].length,O+=Z,T===void 0?T=Z:0<Z&&(J+=Math.abs(Z-T),T=Z));0<$.data.length&&(O/=$.data.length-B),(H===void 0||J<=H)&&(N===void 0||N<O)&&1.99<O&&(H=J,m=z,N=O)}return{successful:!!(e.delimiter=m),bestDelimiter:m}})(h,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=v.bestDelimiter:(l=!0,e.delimiter=a.DefaultDelimiter),c.meta.delimiter=e.delimiter),le(e));return e.preview&&e.header&&v.preview++,t=h,n=new ue(v),c=n.parse(t,R,b),I(),p?{meta:{paused:!0}}:c||{meta:{paused:!1}}},this.paused=function(){return p},this.pause=function(){p=!0,n.abort(),t=D(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){A.streamer._halted?(p=!1,A.streamer.parseChunk(t,!0)):setTimeout(A.resume,3)},this.aborted=function(){return G},this.abort=function(){G=!0,n.abort(),c.meta.aborted=!0,D(e.complete)&&e.complete(c),t=""},this.guessLineEndings=function(C,v){C=C.substring(0,1048576);var v=new RegExp(re(v)+"([^]*?)"+re(v),"gm"),b=(C=C.replace(v,"")).split("\r"),v=C.split(`
`),C=1<v.length&&v[0].length<b[0].length;if(b.length===1||C)return`
`;for(var F=0,_=0;_<b.length;_++)b[_][0]===`
`&&F++;return F>=b.length/2?`\r
`:"\r"}}function re(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ue(e){var t=(e=e||{}).delimiter,n=e.newline,l=e.comments,u=e.step,g=e.preview,K=e.fastMode,W=null,S=e.quoteChar==null?'"':e.quoteChar,A=S;if(e.escapeChar!==void 0&&(A=e.escapeChar),(typeof t!="string"||-1<a.BAD_DELIMITERS.indexOf(t))&&(t=","),l===t)throw new Error("Comment character same as delimiter");l===!0?l="#":(typeof l!="string"||-1<a.BAD_DELIMITERS.indexOf(l))&&(l=!1),n!==`
`&&n!=="\r"&&n!==`\r
`&&(n=`
`);var f=0,j=!1;this.parse=function(p,G,E){if(typeof p!="string")throw new Error("Input must be a string");var c=p.length,V=t.length,I=n.length,L=l.length,U=D(u),h=[],R=[],b=[],v=f=0;if(!p)return z();if(K||K!==!1&&p.indexOf(S)===-1){for(var C=p.split(n),F=0;F<C.length;F++){if(b=C[F],f+=b.length,F!==C.length-1)f+=n.length;else if(E)return z();if(!l||b.substring(0,L)!==l){if(U){if(h=[],T(b.split(t)),J(),j)return z()}else T(b.split(t));if(g&&g<=F)return h=h.slice(0,g),z(!0)}}return z()}for(var _=p.indexOf(t,f),k=p.indexOf(n,f),M=new RegExp(re(A)+re(S),"g"),m=p.indexOf(S,f);;)if(p[f]===S)for(m=f,f++;;){if((m=p.indexOf(S,m+1))===-1)return E||R.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:h.length,index:f}),te();if(m===c-1)return te(p.substring(f,m).replace(M,S));if(S===A&&p[m+1]===A)m++;else if(S===A||m===0||p[m-1]!==A){_!==-1&&_<m+1&&(_=p.indexOf(t,m+1));var H=N((k=k!==-1&&k<m+1?p.indexOf(n,m+1):k)===-1?_:Math.min(_,k));if(p.substr(m+1+H,V)===t){b.push(p.substring(f,m).replace(M,S)),p[f=m+1+H+V]!==S&&(m=p.indexOf(S,f)),_=p.indexOf(t,f),k=p.indexOf(n,f);break}if(H=N(k),p.substring(m+1+H,m+1+H+I)===n){if(b.push(p.substring(f,m).replace(M,S)),Z(m+1+H+I),_=p.indexOf(t,f),m=p.indexOf(S,f),U&&(J(),j))return z();if(g&&h.length>=g)return z(!0);break}R.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:h.length,index:f}),m++}}else if(l&&b.length===0&&p.substring(f,f+L)===l){if(k===-1)return z();f=k+I,k=p.indexOf(n,f),_=p.indexOf(t,f)}else if(_!==-1&&(_<k||k===-1))b.push(p.substring(f,_)),f=_+V,_=p.indexOf(t,f);else{if(k===-1)break;if(b.push(p.substring(f,k)),Z(k+I),U&&(J(),j))return z();if(g&&h.length>=g)return z(!0)}return te();function T(O){h.push(O),v=f}function N(O){var B=0;return B=O!==-1&&(O=p.substring(m+1,O))&&O.trim()===""?O.length:B}function te(O){return E||(O===void 0&&(O=p.substring(f)),b.push(O),f=c,T(b),U&&J()),z()}function Z(O){f=O,T(b),b=[],k=p.indexOf(n,f)}function z(O){if(e.header&&!G&&h.length){var B=h[0],$={},Q=new Set(B);let me=!1;for(let ne=0;ne<B.length;ne++){let Y=B[ne];if($[Y=D(e.transformHeader)?e.transformHeader(Y,ne):Y]){let ie,Ee=$[Y];for(;ie=Y+"_"+Ee,Ee++,Q.has(ie););Q.add(ie),B[ne]=ie,$[Y]++,me=!0,(W=W===null?{}:W)[ie]=Y}else $[Y]=1,B[ne]=Y;Q.add(Y)}me&&console.warn("Duplicate headers found and renamed.")}return{data:h,errors:R,meta:{delimiter:t,linebreak:n,aborted:j,truncated:!!O,cursor:v+(G||0),renamedHeaders:W}}}function J(){u(z()),h=[],R=[]}},this.abort=function(){j=!0},this.getCharIndex=function(){return f}}function Ae(e){var t=e.data,n=y[t.workerId],l=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var u={abort:function(){l=!0,ye(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:ge,resume:ge};if(D(n.userStep)){for(var g=0;g<t.results.data.length&&(n.userStep({data:t.results.data[g],errors:t.results.errors,meta:t.results.meta},u),!l);g++);delete t.results}else D(n.userChunk)&&(n.userChunk(t.results,u,t.file),delete t.results)}t.finished&&!l&&ye(t.workerId,t.results)}function ye(e,t){var n=y[e];D(n.userComplete)&&n.userComplete(t),n.terminate(),delete y[e]}function ge(){throw new Error("Not implemented.")}function le(e){if(typeof e!="object"||e===null)return e;var t,n=Array.isArray(e)?[]:{};for(t in e)n[t]=le(e[t]);return n}function X(e,t){return function(){e.apply(t,arguments)}}function D(e){return typeof e=="function"}return a.parse=function(e,t){var n=(t=t||{}).dynamicTyping||!1;if(D(n)&&(t.dynamicTypingFunction=n,n={}),t.dynamicTyping=n,t.transform=!!D(t.transform)&&t.transform,!t.worker||!a.WORKERS_SUPPORTED)return n=null,a.NODE_STREAM_INPUT,typeof e=="string"?(e=(l=>l.charCodeAt(0)!==65279?l:l.slice(1))(e),n=new(t.download?P:ee)(t)):e.readable===!0&&D(e.read)&&D(e.on)?n=new oe(t):(r.File&&e instanceof File||e instanceof Object)&&(n=new q(t)),n.stream(e);(n=(()=>{var l;return!!a.WORKERS_SUPPORTED&&(l=(()=>{var u=r.URL||r.webkitURL||null,g=d.toString();return a.BLOB_URL||(a.BLOB_URL=u.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",g,")();"],{type:"text/javascript"})))})(),(l=new r.Worker(l)).onmessage=Ae,l.id=x++,y[l.id]=l)})()).userStep=t.step,n.userChunk=t.chunk,n.userComplete=t.complete,n.userError=t.error,t.step=D(t.step),t.chunk=D(t.chunk),t.complete=D(t.complete),t.error=D(t.error),delete t.worker,n.postMessage({input:e,config:t,workerId:n.id})},a.unparse=function(e,t){var n=!1,l=!0,u=",",g=`\r
`,K='"',W=K+K,S=!1,A=null,f=!1,j=((()=>{if(typeof t=="object"){if(typeof t.delimiter!="string"||a.BAD_DELIMITERS.filter(function(E){return t.delimiter.indexOf(E)!==-1}).length||(u=t.delimiter),typeof t.quotes!="boolean"&&typeof t.quotes!="function"&&!Array.isArray(t.quotes)||(n=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(S=t.skipEmptyLines),typeof t.newline=="string"&&(g=t.newline),typeof t.quoteChar=="string"&&(K=t.quoteChar),typeof t.header=="boolean"&&(l=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");A=t.columns}t.escapeChar!==void 0&&(W=t.escapeChar+K),t.escapeFormulae instanceof RegExp?f=t.escapeFormulae:typeof t.escapeFormulae=="boolean"&&t.escapeFormulae&&(f=/^[=+\-@\t\r].*$/)}})(),new RegExp(re(K),"g"));if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return p(null,e,S);if(typeof e[0]=="object")return p(A||Object.keys(e[0]),e,S)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||A),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:typeof e.data[0]=="object"?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||typeof e.data[0]=="object"||(e.data=[e.data])),p(e.fields||[],e.data||[],S);throw new Error("Unable to serialize unrecognized input");function p(E,c,V){var I="",L=(typeof E=="string"&&(E=JSON.parse(E)),typeof c=="string"&&(c=JSON.parse(c)),Array.isArray(E)&&0<E.length),U=!Array.isArray(c[0]);if(L&&l){for(var h=0;h<E.length;h++)0<h&&(I+=u),I+=G(E[h],h);0<c.length&&(I+=g)}for(var R=0;R<c.length;R++){var b=(L?E:c[R]).length,v=!1,C=L?Object.keys(c[R]).length===0:c[R].length===0;if(V&&!L&&(v=V==="greedy"?c[R].join("").trim()==="":c[R].length===1&&c[R][0].length===0),V==="greedy"&&L){for(var F=[],_=0;_<b;_++){var k=U?E[_]:_;F.push(c[R][k])}v=F.join("").trim()===""}if(!v){for(var M=0;M<b;M++){0<M&&!C&&(I+=u);var m=L&&U?E[M]:M;I+=G(c[R][m],M)}R<c.length-1&&(!V||0<b&&!C)&&(I+=g)}}return I}function G(E,c){var V,I;return E==null?"":E.constructor===Date?JSON.stringify(E).slice(1,25):(I=!1,f&&typeof E=="string"&&f.test(E)&&(E="'"+E,I=!0),V=E.toString().replace(j,W),(I=I||n===!0||typeof n=="function"&&n(E,c)||Array.isArray(n)&&n[c]||((L,U)=>{for(var h=0;h<U.length;h++)if(-1<L.indexOf(U[h]))return!0;return!1})(V,a.BAD_DELIMITERS)||-1<V.indexOf(u)||V.charAt(0)===" "||V.charAt(V.length-1)===" ")?K+V+K:V)}},a.RECORD_SEP="",a.UNIT_SEP="",a.BYTE_ORDER_MARK="\uFEFF",a.BAD_DELIMITERS=["\r",`
`,'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!i&&!!r.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=ue,a.ParserHandle=he,a.NetworkStreamer=P,a.FileStreamer=q,a.StringStreamer=ee,a.ReadableStreamStreamer=oe,r.jQuery&&((s=r.jQuery).fn.parse=function(e){var t=e.config||{},n=[];return this.each(function(g){if(!(s(this).prop("tagName").toUpperCase()==="INPUT"&&s(this).attr("type").toLowerCase()==="file"&&r.FileReader)||!this.files||this.files.length===0)return!0;for(var K=0;K<this.files.length;K++)n.push({file:this.files[K],inputElem:this,instanceConfig:s.extend({},t)})}),l(),this;function l(){if(n.length===0)D(e.complete)&&e.complete();else{var g,K,W,S,A=n[0];if(D(e.before)){var f=e.before(A.file,A.inputElem);if(typeof f=="object"){if(f.action==="abort")return g="AbortError",K=A.file,W=A.inputElem,S=f.reason,void(D(e.error)&&e.error({name:g},K,W,S));if(f.action==="skip")return void u();typeof f.config=="object"&&(A.instanceConfig=s.extend(A.instanceConfig,f.config))}else if(f==="skip")return void u()}var j=A.instanceConfig.complete;A.instanceConfig.complete=function(p){D(j)&&j(p,A.file,A.inputElem),u()},a.parse(A.file,A.instanceConfig)}}function u(){n.splice(0,1),l()}}),o&&(r.onmessage=function(e){e=e.data,a.WORKER_ID===void 0&&e&&(a.WORKER_ID=e.workerId),typeof e.input=="string"?r.postMessage({workerId:a.WORKER_ID,results:a.parse(e.input,e.config),finished:!0}):(r.File&&e.input instanceof File||e.input instanceof Object)&&(e=a.parse(e.input,e.config))&&r.postMessage({workerId:a.WORKER_ID,results:e,finished:!0})}),(P.prototype=Object.create(w.prototype)).constructor=P,(q.prototype=Object.create(w.prototype)).constructor=q,(ee.prototype=Object.create(ee.prototype)).constructor=ee,(oe.prototype=Object.create(w.prototype)).constructor=oe,a})});var Ie=Pe(_e());function fe(d,r){let s=Symbol(),i=d;return()=>(i[s]??=r(),i[s])}async function we(d,r,s,i){let o=d[Symbol.iterator](),y=0,x=!1;for(;!x;){for(let a=0;a<r;a++,y++){let w=o.next();if(w.done){x=!0;break}s(w.value,y)}i?.(),await new Promise(a=>setTimeout(a,0))}}var Ze=Object.freeze([]),Oe=Symbol("DataView header"),Xe=Symbol("DataView data offset");function Ve(d,r){let s=String(d).replace(/\s+/g,"");return`get${s.slice(0,1).toUpperCase()+s.slice(1)}${r}`}function Fe(d,r,s){let i=d.keyMapping[r];if(i===void 0)return()=>{};if(s==="At"){let{data:o,offset:y}=d;return x=>(o[x+y]??{})[i]}else return o=>o[i]}function Ke(d,r){let s=["At","For"];for(let i of r)for(let o of s){let y=Ve(i,o),x=Fe(d,i,o);d[y]=x}}function Ne(d,...r){let[s]=r.filter(o=>o!==void 0),i=s[Oe];return i===void 0?Object.entries(s):Array.isArray(d.at(0))?i.map((o,y)=>[o,y]):i.map(o=>[o,o])}function ke(d){class r{constructor(i,o,y=0){this.data=i;this.keyMapping=o;this.offset=y;this.keys=d;this.at=i=>this.data[this.offset+i];this.getPropertyAt=(i,o)=>this.getPropertyFor(this.data[this.offset+i]??{},o);this.getPropertyFor=(i,o)=>{let y=this.keyMapping[o];if(y!==void 0)return i[y]};this.materializeAt=(i,o)=>this.materializeFor(this.at(i),o);this.materializeFor=(i,o)=>{let y=Ne(this,o,this.keyMapping),x={};for(let[a,w]of y){let P=i[w],q=typeof P=="object"?JSON.stringify(P):P;x[a]=q}return x};this.length=i.length-y,Ke(this,this.keys)}[Symbol.iterator](){let i=this.data[Symbol.iterator]();for(let o=0;o<this.offset;o++)i.next();return i}}return r}var Le=["Cell Type","X","Y"],ze=["Cell Ontology ID","Z"],je=ke([...Le,...ze]),se=class extends je{constructor(){super(...arguments);this.getPositionAt=(s,i)=>this.getPositionFor(this.at(s),i);this.getPositionFor=(s,i)=>{let o=i?.target??new Array(3);return o[0]=this.getXFor(s),o[1]=this.getYFor(s),o[2]=this.getZFor(s)??0,o};this.getDimensions=fe(this,()=>{let s=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let o of this){let y=this.getXFor(o),x=this.getYFor(o),a=this.getZFor(o)??0;s=Math.min(s,y,x,a),i=Math.max(i,y,x,a)}return[s,i]});this.getCounts=fe(this,()=>{let s={};for(let i of this){let o=this.getCellTypeFor(i);s[o]??=0,s[o]+=1}return new Map(Object.entries(s))});this.createFilter=s=>(i,o)=>s.includes(this.getCellTypeFor(i),o);this.createReindexer=async s=>{let o=[],y=-1;return await we(this,2e4,(x,a)=>{let w=s.includes(this.getCellTypeFor(x),a);y+=Number(w),o.push(y)}),o}}},ut=new se([],{"Cell Type":0,X:1,Y:2});var Ue=[[-1,-1],[-1,0],[-1,1],[1,-1],[1,0],[1,1],[0,-1],[0,0],[0,1]],ae=class{constructor(){this.grid={}}addCellAt(r,s,i){this.ensureCellsExistsAt(r,s).push(i)}getCellsAt(r,s){return this.grid[r]?.[s]}*getNonEmptyIndices(){for(let r in this.grid)for(let s in this.grid[r])yield[+r,+s]}*getNeighborhood(r,s){for(let[i,o]of Ue){let y=this.getCellsAt(r+i,s+o);y!==void 0&&(yield*y)}}ensureCellsExistsAt(r,s){return this.grid[r]??={},this.grid[r][s]??=[],this.grid[r][s]}};function We(d,r,s){let i=new ae,o=new ae,y=0;for(let x of d){let a=d.getCellTypeFor(x),w={index:y,type:a,x:d.getXFor(x),y:d.getYFor(x),z:d.getZFor(x)??0,object:x},P=a===r?o:i,q=Math.floor(w.x/s),ee=Math.floor(w.y/s);P.addCellAt(q,ee,w),y++}return{sourceCells:i,targetCells:o}}function He(d,r){let s=d.x-r.x,i=d.y-r.y,o=d.z-r.z;return s*s+i*i+o*o}function Be(d,r,s){let i=s*s,o;for(let y of r){let x=He(d,y);x<i&&(i=x,o=y)}return o}function*xe(d,r,s){let{sourceCells:i,targetCells:o}=We(d,r,s);if(Object.keys(o).length===0){console.warn(`No target cells found using selector '${r}'`);return}for(let[y,x]of i.getNonEmptyIndices()){let a=Array.from(o.getNeighborhood(y,x));for(let w of i.getCellsAt(y,x)??[]){let P=Be(w,a,s);P!==void 0&&(yield{"Cell ID":w.index,"Target ID":P.index,X1:w.x,Y1:w.y,Z1:w.z,X2:P.x,Y2:P.y,Z2:P.z})}}}var dt=new Intl.DateTimeFormat(void 0,{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3});function pe(d,r){return{type:"progress",processed:d,total:r,timestamp:Date.now()}}function qe(d){return{type:"result",edges:{data:d,keyMapping:{"Cell ID":"Cell ID","Target ID":"Target ID",X1:"X1",Y1:"Y1",Z1:"Z1",X2:"X2",Y2:"Y2",Z2:"Z2"},offset:0}}}addEventListener("message",d=>{let{nodes:{data:r,keyMapping:s,offset:i},targetSelector:o,maxDistance:y,reportStep:x=Math.floor(r.length/20)}=d.data,a=new se(r,s,i),{length:w}=a,P=[];postMessage(pe(0,w));for(let q of xe(a,o,y))P.push(q),P.length%x===0&&postMessage(pe(P.length,w));postMessage(pe(w,w)),postMessage(qe(P))});
